(function(b){b.touchslider=function(h){var g=b(h),f=("ontouchstart" in window)||window.DocumentTouch&&document instanceof DocumentTouch,a={};b.data(h,"touchslider",g);a={init:function(){g.container=b("ul.slides",g);g.slides=b("li",g.container);g.find("div.loading").remove();g.container.show();g.x=0;g.switchs=true;b("a",g.slides).bind("click",function(){var c=g.container.position().left;if(Math.abs(c-g.x)>5){g.setProps(Math.abs(c));return false}});g.prop="marginLeft";g.args={};g.transitions=(function(){var c=document.createElement("div"),d=["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"];for(var e in d){if(c.style[d[e]]!==undefined){g.pfx=d[e].replace("Perspective","").toLowerCase();g.prop="-"+g.pfx+"-transform";return true}}return false}());g.doMath();g.setup();if(g.switchs){if(f){a.touch()}b(window).bind("resize focus",a.resize)}},touch:function(){var e,u,x,D,A,d,w,z,y,B,t=false;h.addEventListener("touchstart",v,false);function v(i){if(i.touches.length===1){d=Number(new Date());A=0;z=0;y=0;x=Math.abs(g.x);e=i.touches[0].pageX;u=i.touches[0].pageY;h.addEventListener("touchmove",C,false);h.addEventListener("touchend",c,false)}}function C(i){D=e-i.touches[0].pageX;t=(Math.abs(D)<Math.abs(i.touches[0].pageY-u));if(!t){i.preventDefault();var j=Number(new Date())-d;z+=parseInt(Math.abs(D)*100/j)>30?50:20;y++;if(Math.abs(D-A)>3){A=D;var k=x+D;if(g.transitions&&k>-50&&Math.abs(k)<g.tw-g.w+50){g.setProps(k,"setTouch")}}}}function c(i){if(g.transitions){var k;if(g.x>0){k=0}else{w=z/y;var j=(Math.abs(g.x)-x)*(w>30?parseInt(w/10):1);k=x+j}if(k<0){k=0;j=-x}else{if(Math.abs(k)>g.tw-g.w){k=g.tw-g.w;j=k-x}}g.setProps(k,"setTouch",Math.abs(j))}h.removeEventListener("touchmove",C,false);h.removeEventListener("touchend",c,false);e=null;u=null;D=null;x=null}},resize:function(){if(g.is(":visible")){g.doMath();g.setProps(0,"setTotal",400)}}};g.setProps=function(c,j,e){var d=(function(){var i=(function(){switch(j){case"setTotal":return(Math.abs(g.x)>g.tw-g.w)?(g.tw-g.w<0?0:g.tw-g.w):Math.abs(g.x);case"setTouch":return c;default:return c}}());g.x=i*-1;return g.x+"px"}());if(g.transitions){d="translate3d("+d+",0,0)";e=(e!==undefined)?(e/1000)+"s":"0s";g.container.css("-"+g.pfx+"-transition-duration",e)}g.args[g.prop]=d;if(g.transitions||e===undefined){g.container.css(g.args)}};g.setup=function(){g.viewport=b('<div class="flex-viewport"></div>').appendTo(g).append(g.container);g.w=g.viewport.width();g.container.width(g.tw+"px");var c=g.tw-g.w;if(c<0){g.x=0;g.switchs=false;return}else{if(g.x>=c){g.x=c}}g.setProps(g.x,"init")};g.doMath=function(){if(g.viewport){g.w=g.viewport.width()}g.tw=0;g.slides.each(function(){if(b(this).attr("class")=="cur"){g.x=g.tw}g.tw+=b(this).outerWidth()})};a.init()};b.fn.touchslider=function(){return this.each(function(){new b.touchslider(this)})}})(jQuery);

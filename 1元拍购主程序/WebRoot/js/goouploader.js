function GooUploader(a,b){this.$multiple=false;if(b.multiple){this.$multiple=b.multiple}this.$div=a;this.$width=b.width||300;this.$height=b.height||36;this.$div.addClass("Uploader").css({width:this.$width-4+"px",height:this.$height-4+"px"});this.$div.append("<div class='total_bg'><div class='oper' style='width:"+(this.$width-14)+"px;'></div><div class='content' style='height:"+(this.$height>36?(this.$height-40):30)+"px;width:"+(this.$multiple?(this.$width-16):(this.$width-6))+"px;"+(this.$multiple?"":"margin:0px;")+"'></div></div>");this.$btn_add=$("<div class='upload_btn' style='margin-right:4px;'><div class='left'></div><div><b class='add'>"+(b.btn_add_text||"Add")+"</b></div><div class='right'></div><div id='"+this.$div.attr("id")+"_addFile'></div></div>");this.$div_btn=this.$div.children("div").children(".oper");this.$div_btn.append(this.$btn_add);this.$content=this.$div.children("div").children(".content");this.$goon=null;this.$swfUpload=new SWFUpload({upload_url:b.upload_url||"",flash_url:b.flash_url||"swfupload.swf",file_size_limit:b.file_size_limit||0,file_upload_limit:b.file_upload_limit||0,post_params:b.post_params||null,file_types:b.file_types||"*.*",file_types_description:b.file_types_description||"All Files",file_queue_limit:b.file_queue_limit||0,button_width:"68",button_height:"20",button_placeholder_id:this.$div.attr("id")+"_addFile",button_cursor:SWFUpload.CURSOR.HAND,button_action:(this.$multiple?SWFUpload.BUTTON_ACTION.SELECT_FILES:SWFUpload.BUTTON_ACTION.SELECT_FILE),button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT});if(this.$multiple){this.$btn_upload=$("<div class='upload_btn'><div class='left'></div><div><b class='upload'>"+(b.btn_up_text||"Upload")+"</b></div><div class='right'></div></div>");this.$btn_cancel=$("<div class='upload_btn' style='display:none'><div class='left'></div><div><b class='cancel'>"+(b.btn_cancel_text||"Cancel")+"</b></div><div class='right'></div></div>");this.$btn_clean=$("<div class='upload_btn' style='float:right'><div class='left'></div><div><b class='clean'>"+(b.btn_clean_text||"Clean")+"</b></div><div class='right'></div></div>");this.$div_btn.append(this.$btn_upload).append(this.$btn_cancel).append(this.$btn_clean)}this.fixFileTypeIcon=function(e){var d=e.split(".");if(d[1]){d[1]=d[1].substring(0,3).toLowerCase()}else{return""}switch(d[1]){case"doc":return"doc";case"wps":return"doc";case"zip":return"zip";case"rar":return"zip";case"ace":return"zip";case"7z":return"zip";case"swf":return"swf";case"fla":return"swf";case"rmv":return"dvd";case"rm":return"dvd";case"wmv":return"dvd";case"avi":return"dvd";case"mpg":return"dvd";case"chm":return"book";case"pdf":return"book";case"ppt":return"ppt";case"xls":return"xls";case"exe":return"exe";case"bat":return"exe";case"cpp":return"scr";case"js":return"scr";case"jav":return"scr";case"css":return"scr";case"cs":return"scr";case"h":return"scr";case"cgi":return"scr";case"jpg":return"img";case"gif":return"img";case"png":return"img";case"psd":return"img";case"bmp":return"img";case"htm":return"htm";case"xml":return"htm";case"xht":return"htm";case"sht":return"htm";case"asp":return"htm";case"jsp":return"htm";case"php":return"htm";case"txt":return"txt";case"cfg":return"cfg";case"dll":return"cfg";case"ini":return"cfg";case"mp3":return"mp3";case"wma":return"mp3";case"ape":return"mp3";case"wav":return"mp3";case"mid":return"mp3";default:return"oth"}};this.getFileSize=function(d){var e=(d/1024).toFixed(1);if(e>1200){e=(e/1024).toFixed(1);if(e>1200){e=(e/1024).toFixed(1);return e+"g"}return e+"m"}return e+"k"};this.$fileList=[];var c=this;this.getFileNames=function(){var e="";for(var d in this.$fileList){e+=this.$fileList[d].name+","}if(e.indexOf(",")>-1){return e.substring(0,e.length-1)}else{return e}};this.$swfUpload.fileQueued=function(d){if(!c.$multiple){c.$div_btn.css({height:"0px","padding-top":"0px"});c.$content.css("display","block")}var e=d.id;c.$fileList[e]={id:d.id,name:d.name,size:c.getFileSize(d.size),filestatus:d.filestatus};c.$content.append("<li id="+d.id+" style='width;"+(c.$content.attr("offsetWidth")-18)+"px'><b class='"+c.fixFileTypeIcon(d.type)+"'></b><div class='labe' title='"+d.name+" ("+c.$fileList[e].size+")'><div class='file' style='width:"+(c.$content.attr("offsetWidth")-85)+"px'>"+(c.$fileList[e].name.length>16?c.$fileList[e].name.substring(0,13)+"...":c.$fileList[e].name)+" ("+c.$fileList[e].size+")</div><div class='unbar'><div></div></div></div><span></span><b class='op_del' title='"+(b.op_del_text||"Del Item")+"' style='display:block'></b><b class='op_up' title='"+(b.op_up_text||"Upload Item")+"' style='display:block'></b><b class='op_ok' title='"+(b.op_ok_text||"Upload Success")+"'></b><b class='op_no' title='"+(b.op_no_text||"Cancel Item")+"'></b><b class='op_fail' title='"+(b.op_fail_text||"Cancel Item")+"'></b></li>");c.$fileList[e].bar=c.$content.children("#"+d.id).children("div").children(".unbar");c.$fileList[e].span=c.$content.children("#"+d.id).children("span")};this.$swfUpload.uploadSuccess=function(e,f){var g=e.id;c.$fileList[g].span.html("100%");var d=c.$content.children("#"+g);d.children(".op_no").css("display","none");d.children(".op_ok").css("display","block")};this.$swfUpload.uploadError=function(e,f,g){var d=c.$content.children("#"+e.id);d.children(".op_no").css("display","none");d.children(".op_fail").css("display","block")};this.$swfUpload.uploadComplete=function(e){while(c.$goon){var d=c.$content.children("#"+e.id).next("li");c.$goon=d.attr("id");if(d.children(".op_up").css("display")=="block"){d.children(".op_up").click();break}}if((!c.$goon)&&c.$multiple){c.$btn_upload.css({display:"block"});c.$btn_cancel.css({display:"none"})}};this.$swfUpload.uploadProgress=function(f,d,g){var e=Math.floor((d/g)*100);c.$fileList[f.id].span.html(e+"%");c.$fileList[f.id].bar.children("div").width(140*((100-e)/100))};if(this.$multiple){this.$btn_upload.bind("click",{content:this.$content,fileList:this.$fileList,cancel:this.$btn_cancel},function(g){for(var f in g.data.fileList){var d=g.data.content.children("#"+f);if(d.children(".op_up").css("display")=="block"){c.$goon=d.attr("id");d.children(".op_up").click();this.style.display="none";g.data.cancel.css({display:"block"});break}}});this.$btn_cancel.bind("click",{content:this.$content,fileList:this.$fileList},function(g){for(var f in g.data.fileList){var d=g.data.content.children("#"+f);if(d.children(".op_up").css("display")=="block"){d.children(".op_up").css("display","none");d.children(".op_del").css("display","none");d.children(".op_no").click()}else{if(d.children(".op_no").css("display")=="block"){d.children(".op_no").click()}}}});this.$btn_clean.bind("click",{swfUpload:this.$swfUpload,content:this.$content,fileList:this.$fileList},function(f){if(f.data.swfUpload.getStats().in_progress==0){for(var d in f.data.fileList){f.data.content.children("#"+d).remove();f.data.fileList[d]=null}}})}this.$content.bind("click",{swfUpload:this.$swfUpload,oper:this.$div_btn,multi:this.$multiple,fileList:this.$fileList},function(j){if(!j){j=window.event}if(j.target.tagName=="B"){var f=$(j.target);var d=d=f.parent();var g=f.attr("className");var k=d.attr("id");switch(g){case"op_up":if(j.data.swfUpload.getStats().in_progress==0){var h=j.data.fileList;h[k].bar.removeClass("unbar");h[k].bar.addClass("bar");h[k].span.html("0%");try{j.data.swfUpload.startUpload(k)}catch(i){alert(i)}f.css("display","none");d.children(".op_del").css("display","none");d.children(".op_no").css("display","block")}break;case"op_del":try{j.data.swfUpload.cancelUpload(k)}catch(i){alert(i)}if(!j.data.multi){j.data.oper.css({height:"20px","padding-top":"5px"});this.style.display="none"}d.remove();j.data.fileList[k]=null;break;case"op_ok":if(!j.data.multi){j.data.oper.css({height:"20px","padding-top":"5px"});this.style.display="none"}j.data.swfUpload.cancelUpload(k);j.data.fileList[k]=null;d.remove();break;case"op_no":j.data.swfUpload.cancelUpload(k);f.css("display","none");d.children(".op_fail").css("display","block");break;case"op_fail":if(!j.data.multi){j.data.oper.css({height:"20px","padding-top":"5px"});this.style.display="none"}d.remove();j.data.fileList[k]=null;break}}});if(!this.$multiple){this.$content.css("display","none")}}jQuery.extend({createGooUploader:function(a,b){return new GooUploader(a,b)}});

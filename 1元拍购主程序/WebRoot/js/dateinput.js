DateInput=(function(a){function b(d,c){if(typeof(c)!="object"){c={}}a.extend(this,b.DEFAULT_OPTS,c);this.input=a(d);this.bindMethodsToObj("show","hide","hideIfClickOutside","keydownHandler","selectDate");this.build();this.selectDate();this.hide()}b.DEFAULT_OPTS={month_names:["January","February","March","April","May","June","July","August","September","October","November","December"],short_month_names:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],short_day_names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],start_of_week:1};b.prototype={build:function(){var f=a('<p class="month_nav"><span class="button prev" title="[Page-Up]">&#171;</span> <span class="month_name"></span> <span class="button next" title="[Page-Down]">&#187;</span></p>');this.monthNameSpan=a(".month_name",f);a(".prev",f).click(this.bindToObj(function(){this.moveMonthBy(-1)}));a(".next",f).click(this.bindToObj(function(){this.moveMonthBy(1)}));var e=a('<p class="year_nav"><span class="button prev" title="[Ctrl+Page-Up]">&#171;</span> <span class="year_name"></span> <span class="button next" title="[Ctrl+Page-Down]">&#187;</span></p>');this.yearNameSpan=a(".year_name",e);a(".prev",e).click(this.bindToObj(function(){this.moveMonthBy(-12)}));a(".next",e).click(this.bindToObj(function(){this.moveMonthBy(12)}));var d=a('<div class="nav"></div>').append(f,e);var c="<table><thead><tr>";a(this.adjustDays(this.short_day_names)).each(function(){c+="<th>"+this+"</th>"});c+="</tr></thead><tbody></tbody></table>";this.dateSelector=this.rootLayers=a('<div class="date_selector"></div>').append(d,c).insertAfter(this.input);if(a.browser.msie&&a.browser.version<7){this.ieframe=a('<iframe class="date_selector_ieframe" frameborder="0" src="#"></iframe>').insertBefore(this.dateSelector);this.rootLayers=this.rootLayers.add(this.ieframe);a(".button",d).mouseover(function(){a(this).addClass("hover")});a(".button",d).mouseout(function(){a(this).removeClass("hover")})}this.tbody=a("tbody",this.dateSelector);this.input.change(this.bindToObj(function(){this.selectDate()}));this.selectDate()},selectMonth:function(i){var c=new Date(i.getFullYear(),i.getMonth(),1);if(!this.currentMonth||!(this.currentMonth.getFullYear()==c.getFullYear()&&this.currentMonth.getMonth()==c.getMonth())){this.currentMonth=c;var d=this.rangeStart(i),e=this.rangeEnd(i);var j=this.daysBetween(d,e);var g="";for(var h=0;h<=j;h++){var f=new Date(d.getFullYear(),d.getMonth(),d.getDate()+h,12,0);if(this.isFirstDayOfWeek(f)){g+="<tr>"}if(f.getMonth()==i.getMonth()){g+='<td class="selectable_day" date="'+this.dateToString(f)+'">'+f.getDate()+"</td>"}else{g+='<td class="unselected_month" date="'+this.dateToString(f)+'">'+f.getDate()+"</td>"}if(this.isLastDayOfWeek(f)){g+="</tr>"}}this.tbody.empty().append(g);this.monthNameSpan.empty().append(this.monthName(i));this.yearNameSpan.empty().append(this.currentMonth.getFullYear());a(".selectable_day",this.tbody).click(this.bindToObj(function(k){this.changeInput(a(k.target).attr("date"))}));a("td[date="+this.dateToString(new Date())+"]",this.tbody).addClass("today");a("td.selectable_day",this.tbody).mouseover(function(){a(this).addClass("hover")});a("td.selectable_day",this.tbody).mouseout(function(){a(this).removeClass("hover")})}a(".selected",this.tbody).removeClass("selected");a("td[date="+this.selectedDateString+"]",this.tbody).addClass("selected")},selectDate:function(c){if(typeof(c)=="undefined"){c=this.stringToDate(this.input.val())}if(!c){c=new Date()}this.selectedDate=c;this.selectedDateString=this.dateToString(this.selectedDate);this.selectMonth(this.selectedDate)},changeInput:function(c){this.input.val(c).change();this.hide()},show:function(){this.rootLayers.css("display","block");a([window,document.body]).click(this.hideIfClickOutside);this.input.unbind("focus",this.show);a(document.body).keydown(this.keydownHandler);this.setPosition()},hide:function(){this.rootLayers.css("display","none");a([window,document.body]).unbind("click",this.hideIfClickOutside);this.input.focus(this.show);a(document.body).unbind("keydown",this.keydownHandler)},hideIfClickOutside:function(c){if(c.target!=this.input[0]&&!this.insideSelector(c)){this.hide()}},insideSelector:function(d){var c=this.dateSelector.position();c.right=c.left+this.dateSelector.outerWidth();c.bottom=c.top+this.dateSelector.outerHeight();return d.pageY<c.bottom&&d.pageY>c.top&&d.pageX<c.right&&d.pageX>c.left},keydownHandler:function(c){switch(c.keyCode){case 9:case 27:this.hide();return;break;case 13:this.changeInput(this.selectedDateString);break;case 33:this.moveDateMonthBy(c.ctrlKey?-12:-1);break;case 34:this.moveDateMonthBy(c.ctrlKey?12:1);break;case 38:this.moveDateBy(-7);break;case 40:this.moveDateBy(7);break;case 37:this.moveDateBy(-1);break;case 39:this.moveDateBy(1);break;default:return}c.preventDefault()},stringToDate:function(d){var c;if(c=d.match(/^(\d{1,2}) ([^\s]+) (\d{4,4})$/)){return new Date(c[3],this.shortMonthNum(c[2]),c[1],12,0)}else{return null}},dateToString:function(c){return c.getDate()+" "+this.short_month_names[c.getMonth()]+" "+c.getFullYear()},setPosition:function(){var c=this.input.offset();this.rootLayers.css({top:c.top+this.input.outerHeight(),left:c.left});if(this.ieframe){this.ieframe.css({width:this.dateSelector.outerWidth(),height:this.dateSelector.outerHeight()})}},moveDateBy:function(c){var d=new Date(this.selectedDate.getFullYear(),this.selectedDate.getMonth(),this.selectedDate.getDate()+c);this.selectDate(d)},moveDateMonthBy:function(c){var d=new Date(this.selectedDate.getFullYear(),this.selectedDate.getMonth()+c,this.selectedDate.getDate());if(d.getMonth()==this.selectedDate.getMonth()+c+1){d.setDate(0)}this.selectDate(d)},moveMonthBy:function(d){var c=new Date(this.currentMonth.getFullYear(),this.currentMonth.getMonth()+d,this.currentMonth.getDate());this.selectMonth(c)},monthName:function(c){return this.month_names[c.getMonth()]},bindToObj:function(c){var d=this;return function(){return c.apply(d,arguments)}},bindMethodsToObj:function(){for(var c=0;c<arguments.length;c++){this[arguments[c]]=this.bindToObj(this[arguments[c]])}},indexFor:function(c,d){for(var e=0;e<c.length;e++){if(d==c[e]){return e}}},monthNum:function(c){return this.indexFor(this.month_names,c)},shortMonthNum:function(c){return this.indexFor(this.short_month_names,c)},shortDayNum:function(c){return this.indexFor(this.short_day_names,c)},daysBetween:function(c,d){c=Date.UTC(c.getFullYear(),c.getMonth(),c.getDate());d=Date.UTC(d.getFullYear(),d.getMonth(),d.getDate());return(d-c)/86400000},changeDayTo:function(f,e,d){var c=d*(Math.abs(e.getDay()-f-(d*7))%7);return new Date(e.getFullYear(),e.getMonth(),e.getDate()+c)},rangeStart:function(c){return this.changeDayTo(this.start_of_week,new Date(c.getFullYear(),c.getMonth()),-1)},rangeEnd:function(c){return this.changeDayTo((this.start_of_week-1)%7,new Date(c.getFullYear(),c.getMonth()+1,0),1)},isFirstDayOfWeek:function(c){return c.getDay()==this.start_of_week},isLastDayOfWeek:function(c){return c.getDay()==(this.start_of_week-1)%7},adjustDays:function(c){var d=[];for(var e=0;e<c.length;e++){d[e]=c[(e+this.start_of_week)%7]}return d}};a.fn.date_input=function(c){return this.each(function(){new b(this,c)})};a.date_input={initialize:function(c){a("input.date_input").date_input(c)}};return b})(jQuery);jQuery.extend(DateInput.DEFAULT_OPTS,{month_names:["\u4e00\u6708","\u4e8c\u6708","\u4e09\u6708","\u56db\u6708","\u4e94\u6708","\u516d\u6708","\u4e03\u6708","\u516b\u6708","\u4e5d\u6708","\u5341\u6708","\u5341\u4e00\u6708","\u5341\u4e8c\u6708"],short_day_names:["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"]});jQuery.extend(DateInput.DEFAULT_OPTS,{stringToDate:function(a){var b;if(b=a.match(/^(\d{4,4})-(\d{2,2})-(\d{2,2})$/)){return new Date(b[1],b[2]-1,b[3])}else{return null}},dateToString:function(a){var c=(a.getMonth()+1).toString();var b=a.getDate().toString();if(c.length==1){c="0"+c}if(b.length==1){b="0"+b}return a.getFullYear()+"-"+c+"-"+b}});

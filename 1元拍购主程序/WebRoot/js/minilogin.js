$(function(){var h=$skin;var i=$("#divCartLogin");var k=i.find('input[name="userName"]');var j=i.find('input[name="userPwd"]');var g=i.find("input:password");var l=function(){var s=function(m){var n=function(p,o,y){var x=new RegExp(o,"g");return p.replace(x,y)};var m=escape(m);m=n(m,"\\+","%2B");m=n(m,"/","%2F");return m};var f=function(m){var n=/^1\d{10}$/;return n.exec(m)};var a=function(n){var m=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;return m.test(n)};var d=function(m){var n=/^[\S]{6,20}$/;return n.exec(m)};function w(m,n){document.cookie=m+"="+escape(n)+";id=1ypg;path=/;domain="+$domain}function v(n,p,m){var o=m;var x=new Date();x.setTime(x.getTime()+o*24*60*60*1000);document.cookie=n+"="+escape(p)+";id=1ypg;path=/;expires="+x.toGMTString()+";domain="+$domain}function u(n){var m=document.cookie.match(new RegExp("(^| )"+n+"=([^;]*)(;|$)"));if(m!=null){return unescape(m[2])}return null}var r=function(m){g.parent().next().html(m==""?"":"<cite><i></i>"+m+"</cite>")};var c=k.val();var e=j.val();var q=false;k.focus(function(){if(k.val()==c){k.val("")}k.css({color:"#666666"}).attr("class","input-focus");if(!q){r("")}j.attr("class","input-text");g.attr("class","input-text")}).blur(function(){var m=$(this).val();if(m!=c&&m!=""){if(f(m)||a(m)){r("")}else{r("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7/\u90ae\u7bb1")}k.css("color","#666666")}else{k.val(c).css("color","#bbbbbb");r("")}k.attr("class","input-text")}).keyup(function(){var m=/[\u4E00-\u9FA5]/g;var n=$(this).val();if(m.test(n)){r("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7/\u90ae\u7bb1")}else{if(n.length>100){$(this).val(n.substring(0,100))}}}).keydown(function(m){if(13==((window.event)?event.keyCode:m.keyCode)){t()}});j.focus(function(){if(j.val()==e){j.hide();g.show().focus()}});g.focus(function(){if(!q){var m=k.val();if(f(m)||a(m)){r("")}}g.css({color:"#666666"}).attr("class","input-focus");k.attr("class","input-text")}).blur(function(){var m=g.val();if(m!=""){if(!d(m)){r("\u767b\u5f55\u5bc6\u7801\u4e3a6-20\u957f\u5ea6\u7684\u5b57\u7b26")}else{r("")}j.css("color","#666666")}else{j.val(e).show().css("color","#bbbbbb");g.hide()}g.attr("class","input-text")}).keydown(function(m){if(13==((window.event)?event.keyCode:m.keyCode)){t()}});var t=function(){q=true;var m=true;var n=k.val();if(n==""||n==c){m=false;r("\u8bf7\u8f93\u5165\u624b\u673a\u53f7/\u90ae\u7bb1")}else{if(!f(n)&&!a(n)){m=false;r("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7/\u90ae\u7bb1")}else{r("")}}if(!m){k.focus();return false}var o=g.val();if(o==""){m=false;r("\u8bf7\u8f93\u5165\u767b\u5f55\u5bc6\u7801")}else{if(!d(o)){m=false;r("\u767b\u5f55\u5bc6\u7801\u4e3a6-20\u957f\u5ea6\u7684\u5b57\u7b26")}else{r("")}}if(!m){j.focus();return false}q=false;$.ajax({url:"/login/login.html",type:"post",data:"userName="+n+"&pwd="+s(o),success:function(p){if(p=="userError"){r("\u767b\u5f55\u5e10\u53f7\u4e0d\u5b58\u5728\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165")}else{if(p=="pwdError"){r("\u767b\u5f55\u5bc6\u7801\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165")}else{if(p.userId){v("_uName",n,365);w("userId",p.userId);w("face",p.faceImg)}if(p.userName){w("userName",p.userName)}else{if(p.mail){w("userName",p.mail)}else{if(p.phone){w("userName",p.phone)}}}w("loginType",0);parent.location.href=$www+"/mycart/payment.html"}}},error:function(){alert("\u8FDE\u63A5\u670D\u52A1\u5668\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5\uFF01");window.location.href=$www}});return true};i.find("li.cart-login-btn a").click(function(){return t()});QC.Login({btnId:"btnQQLogin",scope:"get_user_info,add_share",size:"B_M"},function(m,n){if(QC.Login.check()){QC.Login.getMe(function(p,o){$.ajax({url:"/register/authorizeIsExists.action",type:"POST",data:"openId="+encodeURIComponent(p.replace(/(\/)/g,"")),success:function(x){if(x=="true"){$.ajax({type:"POST",url:"/register/authorizeRegsiter.action",data:"userName="+encodeURIComponent(m.nickname.replace(/(\/)/g,""))+"&openId="+p+"&userFace="+m.figureurl_2,success:function(y){w("userId",y.userId);w("userName",y.userName);w("face",y.faceImg);w("loginType",2);parent.location.href=$www+"/mycart/payment.html"}})}else{w("userId",x.userId);w("userName",x.userName);w("face",x.faceImg);w("loginType",2);parent.location.href=$www+"/mycart/payment.html"}}})})}});var b=u("_uName");if(b!=null){k.val(b).css("color","#666666");setTimeout(function(){j.focus()},1)}else{setTimeout(function(){k.focus()},1)}};$.getScript("/js/comm.js?date=20120309",l)});

var isLoadScrollJs=false;$.fn.miniCartTool=function(){var m=$(this);var A=m.children("div.f-unfold-title");var p=m.find("div.cartEmpty");var z=m.find("div.loading-2015");var C=m.find("div.unfold-list");var t=m.children("div.f-unfold-pay");var e=m.find("#cart_box");var f=$www;var q=33;var o=72;var c=84-22;var r=/^\d+$/;var s=$(window).height();var x=(s-50)/2;var B=(s-89)/2;z.css("padding",x+"px 0px");m.css({height:s-2}).show();var w=37;if($.browser.msie&&parseInt($.browser.version)==6){w=36}m.animate({right:w},{duration:500,queue:false,complete:function(){$("#ulRToolList").children("li.f-shopping-cart").addClass("f-checked")}});e.height(s-q-c-8);var d=function(E){if(E&&E.stopPropagation){E.stopPropagation()}else{window.event.cancelBubble=true}};var v=function(G,E,F,I){var H=function(){F.apply(I,arguments)};window.addEventListener?G.addEventListener(E,H,false):G.attachEvent("on"+E,H)},y=function(G,E,F){window.removeEventListener?G.removeEventListener(E,F,false):G.attachEvent("on"+E,F)};var k=function(){var F=0;var E=0;C.children("dl").each(function(){F++;E+=parseInt($(this).attr("buyNum"))});t.find("li.total-txt").html('\u5171<em class="orange">'+F+'</em>\u4e2a\u5546\u54c1\u5408\u8ba1\uff1a<b class="orange">'+E+".00</b>\u5143")};var D="\u5df2\u8d85\u8fc7100\u4eba\u6b21";var j="\u6700\u5c11\u9700"+$shortName+"1\u4eba\u6b21";$.fn.cartFun=function(){$(this).hover(function(){$(this).addClass("hover");$(this).find("input:text").val($(this).attr("buyNum"));$(this).find("p").eq(0).hide().next().show();if($(this).attr("bind")!="1"){E($(this));$(this).attr("bind","1")}},function(){$(this).removeClass("hover");$(this).find("p").eq(0).show().next().hide()});var E=function(I){var M=I;var Q=M.attr("codeid");var F=M.find("input:text");var K=parseInt(F.attr("surplus"));var P=F.prev();var G=F.next();var J=M.find("span.orange");var N=parseInt(F.val());var L=function(R){J.html(R)};var O=function(R){if(parseInt(M.attr("buyNum"))!=R){var count=parseInt(K);var codeid=Q;var json=getCookie("products");if(json==null||json==""){var val="[{'pId':"+codeid+",'num':"+R+"}]";SetCookieByExpires("products",val,R)}else{var flag=false;json=eval("("+json+")");$.each(json,function(n,value){if(codeid==value.pId){value.num=parseInt(R);if(parseInt(R)>count){value.num=count}flag=true}});if(!flag){json.push({pId:+codeid,num:R})}json=JSON.stringify(json);SetCookieByExpires("products",json,R)}N=R;F.val(R);M.attr("buyNum",N).find("cite").eq(0).html("<em>"+$shortName+"\u4eba\u6b21\uff1a</em>"+N).next().html("<em>\u5c0f\u8ba1\uff1a</em>\uffe5"+N+".00");H();k()}else{F.val(M.attr("buyNum"))}};var H=function(){if(N==1){P.addClass("unclick");G.removeClass("unclick")}else{if(N==K){P.removeClass("unclick");G.addClass("unclick")}else{P.removeClass("unclick");G.removeClass("unclick")}}};F.keyup(function(S){var R=F.val();if(R==""){L(j);O(1)}else{if(!r.test(R)){L("");O(N)}else{R=parseInt(R);if(R==0){L(j);O(1)}else{if(R<=K){if(R>100){L(D)}else{L("")}O(R)}else{L("\u6700\u591a\u80fd"+$shortName+K+"\u4eba\u6b21");O(K)}}}}H()}).mouseover(function(){$(this).attr("mouseIn","1").focus().select();scrollFunc=function(T){T=T||window.event;if(T&&T.preventDefault){T.preventDefault()}else{window.event.returnValue=false}d(T);var U=0;if(T.wheelDelta){U=T.wheelDelta>0?1:-1}else{if(T.detail){U=T.detail<0?1:-1}}if(U&&F.attr("mouseIn")=="1"){var S=parseInt(F.val());if(U>0){if(S>0){if(S>=K){S=K;L("\u6700\u591a\u80fd"+$shortName+K+"\u4eba\u6b21")}else{L("");S=S+1;if(S>100){L(D)}else{L("")}}}else{S=1}}else{if(S>1){S=S-1;if(S>100){L(D)}else{L("")}}else{S=1;L(j)}}F.val(S);H()}};var R=$(this).get(0);v(R,"mousewheel",scrollFunc,R);v(R,"DOMMouseScroll",scrollFunc,R)}).mouseout(function(){$(this).attr("mouseIn","0");var S=F.val();if(S>K){S=K}O(S);var R=$(this).get(0);y(R,"mousewheel",scrollFunc);y(R,"DOMMouseScroll",scrollFunc)});P.click(function(){var R=F.val();if(r.test(R)){var S=parseInt(R);if(S>1){L("");S--;if(S>100){L(D)}else{L("")}O(S);if(S==1){P.addClass("unclick")}G.removeClass("unclick")}else{}}return false});G.click(function(){var R=F.val();if(r.test(R)){var S=parseInt(R);if(S<K){L("");S++;if(S>100){L(D)}else{L("")}O(S);P.removeClass("unclick");if(S==K){G.addClass("unclick")}}else{}}return false});M.find("dd.z-close a").click(function(R){d(R);var at=Q;var json=getCookie("products");if(json!=null||json!=""){json=eval("("+json+")");var is=0;$.each(json,function(n,value){if(at==value.pId){is=n}});json.splice(is,1);json=JSON.stringify(json);SetCookieByExpires("products",json,1);g();return}else{alert("\u62b1\u6b49\uff0c\u5220\u9664\u5931\u8d25\uff01");location.reload()}return false})}};var l=function(L,G,E,I,F){var K="";var H=I>0;K='<dl codeid="'+L+'" buyNum="'+(H?E:0)+'" class="'+(H?"":"hover")+'"><dd><a href="'+mainHttp+"/products/"+L+'.html" title="'+F+'" target="_blank"><img src="'+$img+G+'" /></a></dd><dd class="z-ygrc">'+(H?'<p class="two-row"><cite><em>'+$shortName+"\u4eba\u6b21\uff1a</em>"+E+"</cite><cite><em>\u5c0f\u8ba1\uff1a</em>\uffe5"+E+'.00</cite></p><p class="three-row"><span class="gray6">\u5269\u4f59 '+I+'\u4eba\u6b21</span><span class="modify"><a href="javascript:;" class="'+(E==1?"unclick":"")+'">-</a><input type="text" value="'+E+'" surplus="'+I+'"/><a href="javascript:;" class="'+(E==I?"unclick":"")+'">+</a></span><span class="orange"></span></p>':'<p class="three-row"><span class="gray6" style="margin-top:20px;">\u5df2\u5931\u6548</span></p>')+'</dd><dd class="z-close"><a href="javascript:;" title="\u5220\u9664" class="delete-close"></a></dd></dl>';var J=$(K);if(H){J.cartFun()}else{J.find("dd.z-close a").click(function(M){d(M);var at=$(this).parent().parent().attr("codeid");var json=getCookie("products");if(json!=null||json!=""){json=eval("("+json+")");var is=0;$.each(json,function(n,value){if(at==value.pId){is=n}});json.splice(is,1);json=JSON.stringify(json);SetCookieByExpires("products",json,1);g();return}else{alert("\u62b1\u6b49\uff0c\u5220\u9664\u5931\u8d25\uff01");location.reload()}return false})}return J};var n=function(){var E=s-q-c;return E%o==0?E/o:parseInt(E/o)-1};var i=$("#divRTLogin");var u=function(){var F=$(window).height();var E=$(window).height()-227;i.attr("isOpen","1").css("top",F).html('<iframe id="ifmLogin" src="/login/miniLogin.html" frameborder="0" style="width: 240px; height: 227px; padding: 0px; overflow: auto;"></iframe><a href="javascript:;" class="delete-close"></a>').show().animate({top:E},{queue:false,duration:100,complete:function(){i.find("a.delete-close").click(function(){i.attr("isOpen","0").animate({top:F},{queue:false,duration:100});return false})}})};var b=$("#ulRToolList").children("li:first").find("em");var a=$("#spHCart");var h=true;var g=function(){$.ajax({url:"/mycart/getMyProductCart.html",type:"GET",data:"json="+new Date().getTime(),success:function(O){_IsCartChanged=false;if(O!=null&&O!=""){if(O.length>0){var E=O[O.length-1].productCount;var M=O[O.length-1].moneyCount;var H=O;A.show();z.hide();p.hide();C.empty().show();var N=n();var K=H.length;for(var J=0;J<K;J++){var G=l(H[J].productId,H[J].headImage,H[J].count,(H[J].productPrice-H[J].currentBuyCount),H[J].productName);C.append(G)}var I="<ul>";I+='<li class="total-txt">\u5171<em class="orange">'+E+'</em>\u4e2a\u5546\u54c1\uff0c\u5408\u8ba1\uff1a<b class="orange">'+M+'.00</b>\u5143</li><li class="accounts-btn"><a type="pay" href="javascript:;" title="\u53bb\u7ed3\u7b97">\u53bb\u7ed3\u7b97</a></li>';I+="</ul>";var L=$(I);L.find('a[type="pay"]').click(function(){var userId=getCookie("userId");if(userId!=null){location.href=f+"/mycart/payment.html"}else{u()}return false});t.empty().append(L).show();b.html(E).show();a.html("("+E+")");C.css("top","0px");e.show().children("div.iscroll-drap-parent").remove();if(K>N){var F=function(){isLoadScrollJs=true;new iScroll("cart_box");e.hover(function(){e.children("div.iscroll-drap-parent").fadeIn("slow")},function(){e.children("div.iscroll-drap-parent").fadeOut("slow")});if(h){e.children("div.iscroll-drap-parent").hide()}};if(!isLoadScrollJs){$.getScript("/js/iscroll.js?date=150203",F)}else{F()}}else{return}}h=false}else{A.hide();z.hide();e.hide();C.hide();t.hide();p.css("padding",B+"px 0px").show();b.html("0").hide();a.html("")}}})};if(_IsCartChanged){z.show();g()}_InsertIntoCart=function(){_IsCartChanged=true;if(i.attr("isOpen")=="1"){g()}else{$.ajax({url:"/mycart/buyProductClick.html",type:"GET",success:function(aA){var F=0;if(aA!=""){F=aA.productCount}else{F=0}a.html("("+F+")");F=F>99?"...":F;b.html(F).show()}})}}};

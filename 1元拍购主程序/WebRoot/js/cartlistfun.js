var PagePOPLoginOK=null;$(document).ready(function(){var b=$skin;var f=$www;var a=function(){var g=$.cookie("_cartTips");if(g!="1"&&parseInt($("#hidTotalMoney").val())>100){$("#divTips").show()}else{$("#divTips").hide()}};var c=$("#divEmpty");var e=function(){if(c.length>0){var g="<b></b>"+($("#hidLogined").val()=="0"?'<span>\u5982\u679c\u60a8\u8fd8\u672a\u767b\u5f55\uff0c\u53ef\u80fd\u5bfc\u81f4\u8d2d\u7269\u8f66\u4e3a\u7a7a\uff0c\u8bf7<a href="/login/index.html?forward=mycart">\u9a6c\u4e0a\u767b\u5f55</a></span>':'<span>\u60a8\u7684\u8d2d\u7269\u8f66\u4e3a\u7a7a\uff01<a href="/" title="\u7acb\u5373\u53bb'+$shortName+'>>">\u7acb\u5373\u53bb'+$shortName+'<em class="f-tran">>></em></a></span>');c.html(g)}else{c.empty()}};e();var d=function(){var o="";var x=true;var t=$("#divCartBox");var i=$("#dlCartList");var w=$("#pageDialog");var s=$("#iTotalMoney");var p=$("#btnGoPay");var r=parseInt($("#hidCartState").val());var m='<b class="z-comms"></b>';var u=function(C,y,B){var z="";switch(C){case"allOutDate":z='<div class="z-popUp z-pop-box"><span class="gray3">\u60a8\u7684\u8d2d\u7269\u8f66\u4e2d\u6240\u6709\u5546\u54c1\u5df2\u5931\u6548\uff01</span><a href="javascript:;" title="\u53d6\u6d88" class="z-btn-cancel">\u53d6\u6d88</a><a href="javascript:;" title="\u6e05\u7a7a\u8d2d\u7269\u8f66\u5e76\u8fd4\u56de'+$shortName+'" class="z-btn-determine">\u6e05\u7a7a\u8d2d\u7269\u8f66\u5e76\u8fd4\u56de'+$shortName+"</a></div>";var A=function(){w.find("a.z-btn-cancel").click(function(){$.PageDialog.close();return false});w.find("a.z-btn-determine").click(function(){y();return false})};$.PageDialog(z,{W:512,H:197,close:true,autoClose:false,ready:A});break;case"delNone":z='<div class="z-popUp z-pop-box"><span class="gray3">\u8bf7\u9009\u62e9\u8981\u5220\u9664\u7684\u5546\u54c1\uff01</span><a href="javascript:;" title="\u786e\u5b9a" class="z-btn-determine">\u786e\u5b9a</a></div>';var A=function(){w.find("a.z-btn-determine").click(function(){$.PageDialog.close();return false})};$.PageDialog(z,{W:350,H:197,close:true,autoClose:false,ready:A});break;case"delCart":z='<div class="z-popUp z-pop-box"><span class="gray3">\u786e\u5b9a\u8981\u5220\u9664\u6240\u9009\u7684\u5546\u54c1\uff1f</span><a href="javascript:;" title="\u53d6\u6d88" class="z-btn-cancel">\u53d6\u6d88</a><a href="javascript:;" title="\u786e\u5b9a" class="z-btn-determine">\u786e\u5b9a</a></div>';var A=function(){w.find("a.z-btn-determine").click(function(){y();return false});w.find("a.z-btn-cancel").click(function(){$.PageDialog.close();return false})};$.PageDialog(z,{W:398,H:197,close:true,autoClose:false,ready:A});break;case"delCartOut":z='<div class="z-popUp z-pop-box"><span class="gray3">\u786e\u5b9a\u8981\u5220\u9664\u6240\u6709\u5931\u6548\u5546\u54c1\uff1f</span><a href="javascript:;" title="\u53d6\u6d88" class="z-btn-cancel">\u53d6\u6d88</a><a href="javascript:;" title="\u786e\u5b9a" class="z-btn-determine">\u786e\u5b9a</a></div>';var A=function(){w.find("a.z-btn-determine").click(function(){y();return false});w.find("a.z-btn-cancel").click(function(){$.PageDialog.close();return false})};$.PageDialog(z,{W:398,H:197,close:true,autoClose:false,ready:A});break;case"delCartS":z='<div class="z-popUp z-add-success"><i class="z-arrows"></i>\u5220\u9664\u6210\u529f\uff01</div>';$.PageDialog(z,{W:168,H:65,close:false,autoClose:true,autoTime:1000,submit:y});break;case"delCartF":z='<div class="z-popUp z-sold-out"><i class="z-arrows"></i>\u62b1\u6b49\uff0c\u5220\u9664\u5931\u8d25\uff01</div>';$.PageDialog(z,{W:180,H:65,close:false,autoClose:true,autoTime:1000,submit:y});break;case"buyNumErr":z='<div class="z-popUp z-sold-out"><i class="z-arrows"></i>\u5bf9\u4e0d\u8d77\uff0c\u8d2d\u4e70\u4eba\u6b21\u8f93\u5165\u6709\u8bef\uff01</div>';$.PageDialog(z,{W:258,H:65,close:false,autoClose:true});break;case"selEmpty":z='<div class="z-popUp z-sold-out"><i class="z-arrows"></i>\u5bf9\u4e0d\u8d77\uff0c\u8d2d\u7269\u8f66\u4e2d\u6ca1\u6709\u9009\u4e2d\u7684\u5546\u54c1\uff01</div>';$.PageDialog(z,{W:310,H:65,close:false,autoClose:true});break;case"goodsOff":z='<div class="z-popUp z-sold-out"><i class="z-arrows"></i>\u8be5\u5546\u54c1\u672c\u671f\u7684'+$shortName+"\u5df2\u6ee1\u5458\uff0c\u8bf7\u9009\u62e9\u4e0b\u4e00\u671f\u8fdb\u884c"+$shortName+"\uff01</div>";$.PageDialog(z,{W:420,H:65,close:false,autoClose:true,submit:y});break;case"addCartS":z='<div class="z-popUp z-add-success"><i class="z-arrows"></i>\u6dfb\u52a0\u6210\u529f\uff01</div>';$.PageDialog(z,{W:168,H:65,close:false,autoClose:true,autoTime:1000,obj:B,oL:-60,oT:-50,ready:function(){$("#pageDialogBG").hide()},submit:y});break;case"addCartF":z='<div class="z-popUp z-sold-out"><i class="z-arrows"></i>\u62b1\u6b49\uff0c\u6dfb\u52a0\u5931\u8d25\uff01</div>';$.PageDialog(z,{W:180,H:65,close:false,autoClose:true,autoTime:1000,obj:B,oL:-60,oT:-50,ready:function(){$("#pageDialogBG").hide()},submit:y});break}};var q=function(){var y=0;$("input:text[name=num]").each(function(){var C=parseInt($(this).val());var B=$(this).parent().parent().parent();var A=$("p[class='ts']",B);var z=$("a[type='check']",B);if(z.find("b").length>0&&!isNaN(C)){y+=C}});s.html("\uffe5"+y+".00");$("#hidTotalMoney").val(y)};q();var n=function(){var y=true;i.find('a[type="check"]').each(function(){if(!$(this).find("b").length>0){y=false;return}});if(y){v.html(m)}else{v.html("")}};var h=function(y){if(y&&y.stopPropagation){y.stopPropagation()}else{window.event.cancelBubble=true}};$.fn.CartItemFun=function(){var P=$(this);var y=parseInt(P.attr("codeid"));var G=P.find('a[type="check"]');G.click(function(){var R=$(this).find("b").length>0;if(R){$(this).html("")}else{$(this).html(m)}n();if($(this).attr("isvalid")=="1"){q()}return false});var K=parseInt(G.attr("isValid"))==1;if(K){var I=P.find('input[type="text"]');var J=I.prev("a");var D=I.next("a");var E=/^\d+$/;var A=parseInt(I.val());var z=parseInt(I.attr("surplus"));var O=function(R){var count=parseInt(z);var codeid=y;var json=getCookie("products");if(json==null||json==""){var val="[{'pId':"+codeid+",'num':"+R+"}]";SetCookieByExpires("products",val,R)}else{var flag=false;json=eval("("+json+")");$.each(json,function(n,value){if(codeid==value.pId){value.num=parseInt(R);if(parseInt(R)>count){value.num=count}flag=true}});if(!flag){json.push({pId:+codeid,num:R})}json=JSON.stringify(json);SetCookieByExpires("products",json,R)}A=R;I.val(R);P.find("li.f-cart-subtotal").html("\uffe5"+R+".00");C();q()};var Q=function(R){if(R==""){I.parent().next("p").hide()}else{if(I.parent().next("p").length==0){I.parent().after("<p>"+R+"</p>")}else{I.parent().next("p").html(R).show()}}};var F=function(R){if(R){if(P.next("div.m-list-tips").length==0){var S='<div class="m-list-tips clrfix"><span class="fl orange">\u6e29\u99a8\u63d0\u793a\uff1a\u5df2\u8d85\u8fc7100\u4eba\u6b21\uff0c'+$saitName+"\u5c31\u662f\u82b11\u5143\u5c31\u6709\u53ef\u80fd\u4e70\u52301\u4ef6\u5546\u54c1\uff0c\u662f\u4e00\u79cd\u5206\u4eab\u5f0f\u8d2d\u7269\u5e73\u53f0\uff0c\u53ef\u80fd\u5e26\u6765\u8d85\u503c\u56de\u62a5\u7684\u540c\u65f6\u4e5f\u5b58\u5728\u4e00\u5b9a\u98ce\u9669\uff0c\u8bf7\u8c28\u614e\u53c2\u4e0e\u54e6\uff01</span></div>";P.after(S)}}else{P.next("div.m-list-tips").remove()}};var C=function(){if(A==1){J.attr("class","z-arrows z-less2");D.attr("class","z-arrows z-plus")}else{if(A==z){J.attr("class","z-arrows z-less");D.attr("class","z-arrows z-plus2")}else{J.attr("class","z-arrows z-less");D.attr("class","z-arrows z-plus")}}};var L=null;var H="\u4e0d\u80fd\u5c0f\u4e8e1\u4eba\u6b21";var B="\u4e0d\u80fd\u5927\u4e8e"+z+"\u4eba\u6b21";var N="\u5df2\u8d85\u8fc7100\u4eba\u6b21\uff0c\u8bf7\u8c28\u614e\u53c2\u4e0e";I.keyup(function(T){var R=parseInt(I.val());var S=1;if(R==""){Q(H);S=1}else{if(!E.test(R)){Q("");S=A}else{if(R==0){Q(H);S=1}else{if(R<=z){Q("");if(R>100){F(true)}else{F(false)}S=R}else{Q(B);S=z}}}}O(S)}).mouseover(function(){$(this).attr("mouseIn","1").focus().select();L=function(S){S=S||window.event;if(S&&S.preventDefault){S.preventDefault()}else{window.event.returnValue=false}var T=0;if(S.wheelDelta){T=S.wheelDelta>0?1:-1}else{if(S.detail){T=S.detail<0?1:-1}}if(T&&I.attr("mouseIn")=="1"){var R=parseInt(I.val());if(T>0){if(R>0){if(R>=z){R=z;Q(B)}else{Q("");R=R+1;if(R>100){F(true)}else{F(false)}}}else{R=1}}else{if(R>1){R=R-1;if(R>100){F(true)}else{F(false)}}else{R=1;Q(H)}}I.val(R);P.find("li.f-cart-subtotal").html("\uffe5"+R+".00");C();q()}};if(document.addEventListener){document.addEventListener("DOMMouseScroll",L,false)}window.onmousewheel=document.onmousewheel=L}).mouseout(function(){$(this).attr("mouseIn","0");var R=I.val();O(R);if(document.addEventListener){document.removeEventListener("DOMMouseScroll",L,false)}window.onmousewheel=document.onmousewheel=function(){}});J.click(function(){var R=I.val();if(E.test(R)){var S=parseInt(R);if(S>1){S--;if(S>100){F(true)}else{F(false)}O(S);C()}else{Q(H)}}return false});D.click(function(){var R=I.val();if(E.test(R)){var S=parseInt(R);if(S<z){S++;if(S>100){F(true)}else{F(false)}O(S);C()}else{Q(B)}}return false});if(parseInt(I.val())>100){F(true)}C()}var M=P.find('a[type="delete"]');M.click(function(S){h(S);if($(this).attr("isOpen")=="1"){return}M.attr("isOpen","1");var R=function(){var V=function(){var at=y;var json=getCookie("products");if(json!=null||json!=""){json=eval("("+json+")");var is=0;$.each(json,function(n,value){if(at==value.pId){is=n}});json.splice(is,1);json=JSON.stringify(json);SetCookieByExpires("products",json,1);g();var Y=i.children("dd").length;if(Y==1){location.replace("/mycart/index.html")}else{P.next("div.m-list-tips").remove();P.animate({height:-20},{queue:false,duration:100,complete:function(){P.remove();Y--;var Z=i.children("dd.m-cart-fail").length;if(Y==Z){s.parent().hide();p.parent().hide()}else{q()}if(!K&&Z==0){$("#btnDelUnValid").remove()}if($("div.m-rqtj-con").offset().top<$(window).height()){loadImgFun()}}})}}else{u("delCartF",function(){location.reload()})}};if(K){var T='<div class="z-popUp f-box-prompt '+(K?"":"f-box-gray")+'" style="display:none;"><p>\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f</p><a href="javascript:;" title="\u786e\u5b9a" class="u-btn-determine">\u786e\u5b9a</a><a href="javascript:;" title="\u53d6\u6d88" class="u-btn-cancel">\u53d6\u6d88</a><b><s></s></b></div>';var W=$(T);t.append(W);W.unbind("click").click(function(X){h(X)});var U=M.offset().top-i.offset().top+18;W.css("top",U+"px").show("fast",function(){W.find("a.u-btn-determine").unbind("click").click(function(){V()});W.find("a.u-btn-cancel").unbind("click").click(function(){g()})})}else{V()}};g(R);return false})};var g=function(y){var z=t.children("div.f-box-prompt");if(z.length>0){z.hide("fast",function(){t.find("div.f-box-prompt").remove();i.find('a[type="delete"]').each(function(){$(this).attr("isOpen","0")});if(y!=undefined){y()}})}else{if(y!=undefined){y()}}};t.click(function(){g()});$("body").click(function(){g()});i.children("dd").each(function(){$(this).CartItemFun()});var v=$("#sSelAll");var j=$("#btnSelAll");var k=function(){if(v.find("b").length>0){v.html("");i.find('a[type="check"]').each(function(){$(this).html("")})}else{v.html(m);i.find('a[type="check"]').each(function(){$(this).html(m)})}q()};v.click(function(){k();return false});j.click(function(){k();return false});$("#btnDelete").click(function(){var A=false;var z="";i.find('a[type="check"]').each(function(){if($(this).find("b").length>0){A=true;z+=$(this).attr("codeid")+","}});if(A){z=z.replace(",","");var y=function(){z=z.split(",");var json=getCookie("products");if(json!=null||json!=""){for(var i=0;i<z.length;i++){json=eval("("+json+")");var j=0;$.each(json,function(n,value){if(z[i]==value.pId){j=n}});json.splice(j,1);json=JSON.stringify(json)}SetCookieByExpires("products",json,1);u("delCartS",function(){location.reload()})}else{u("delCartF",function(){location.reload()})}};u("delCart",y)}else{u("delNone")}return false});$("#btnDelUnValid").click(function(){var y="";i.children("dd.m-cart-fail").each(function(){y+=$(this).find('a[type="check"]').attr("codeid")+","});y=y.replace(",","");y=y.split(",");var json=getCookie("products");if(json!=null||json!=""){for(var i=0;i<y.length;i++){json=eval("("+json+")");var j=0;$.each(json,function(n,value){if(y[i]==value.pId){j=n}});json.splice(j,1);json=JSON.stringify(json)}SetCookieByExpires("products",json,1);u("delCartS",function(){location.reload()})}else{u("delCartF",function(){location.reload()})}return false});if(r==1||r==3){s.parent().show();p.parent().show();var l=function(){p.bind("click",function(){o="";i.find('a[type="check"]').each(function(){if(!$(this).find("b").length>0){o+=$(this).attr("codeid")+","}});var C=i.find('a[type="check"]');var B=0;var z=false;for(var A=0;A<C.length;A++){if($(C[A]).find("b").length>0){z=true;break}}if(z){z=true;$("input:text[name=num]").each(function(E){var D=$(this).val();if($(C[E]).find("b").length>0&&(isNaN(D)||D=="0"||D=="")){z=false}});if(!z){u("buyNumErr")}else{var y=function(){var userId=getCookie("userId");if(userId!=null&&userId!=""){location.href=$www+"/mycart/payment.html"}else{var content='<iframe frameborder="0" style="width:700px;height:500px;padding:0px;overflow:auto;" src="'+$www+'/login/fastLogin.html" id="fastLoginFrame" name="fastLoginFrame"></iframe>';$.PageDialog(content,{W:484,H:265,title:"\u4f1a\u5458\u767b\u5f55"})}};y()}}else{u("selEmpty")}})};$.getScript(b+"/js/poplogin.js",l)}else{if(r==2){u("allOutDate",function(){var y="";i.find('a[type="check"]').each(function(){y+=$(this).attr("codeid")+","});y=y.replace(",","");y=y.split(",");var json=getCookie("products");if(json!=null||json!=""){for(var i=0;i<y.length;i++){json=eval("("+json+")");var j=0;$.each(json,function(n,value){if(y[i]==value.pId){j=n}});json.splice(j,1);json=JSON.stringify(json)}SetCookieByExpires("products",json,1);u("delCartS",function(){location.reload()})}else{u("delCartF",function(){location.reload()})}})}}$.ajax({url:"/lottery/upcomingAnnounced.action?pageNo="+1+"&pageSize="+4,type:"get",data:"json",success:function(data){for(var i=0;i<data.length;i++){$('<div class="f-recomm-list" codeid="'+data[i].productId+'"><dl><dt><a href="'+$www+"/products/"+data[i].productId+'.html" title="'+data[i].productName+'"><img src="'+$img+data[i].headImage+'"/></a></dt><dd class="u-recomm-name"><a href="'+$www+"/products/"+data[i].productId+'.html" title="'+data[i].productName+'">'+data[i].productName+'</a></dd><dd class="gray9">\u5269\u4f59<em>'+(data[i].productPrice-data[i].currentBuyCount)+"</em>\u4eba\u6b21</dd></dl></div>").appendTo($("#divRecList"))}$("#divRecList").children("div").each(function(z,y){var A=$(this);A.hover(function(){A.addClass(z==3?"f-recomm-hover f-recomm-hover2":"f-recomm-hover");A.append('<div class="z-mask"></div><a href="javascript:;" class="u-cart-add"></a>');A.children("a.u-cart-add").click(function(){var ID=$(this).parent().attr("codeid");var json=getCookie("products");if(json==null||json==""){var val="[{'pId':"+ID+",'num':1}]";SetCookieByExpires("products",val,1)}else{var flag=false;json=eval("("+json+")");$.each(json,function(n,value){if(ID==value.pId){value.num=(parseInt(value.num)+parseInt(1));flag=true}});if(!flag){json.push({pId:+ID,num:1})}json=JSON.stringify(json);SetCookieByExpires("products",json,1)}u("addCartS",function(){location.replace("/mycart/index.html")},A.find("a.u-cart-add"));return false})},function(){A.removeClass(z==3?"f-recomm-hover f-recomm-hover2":"f-recomm-hover");A.children("div.z-mask").remove();A.children("a.u-cart-add").remove()})})}})};d()});

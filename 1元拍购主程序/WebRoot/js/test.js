var CBLFun=null;var PagePOPLoginOK=null;var ShareUrl,ShareTitle;$(function(){var m="http://skin.1yyg.com";var r="http://img.1yyg.com";var v=$("#hidPostID").val();var u=$("#hidIsLogin").val()=="1";var n=$("#DCMainLeft");var w=$("#emReplyCount");var q=$("#commentMain");var p="postHits";var o=function(){OKDialog("\u63d0\u4ea4\u6210\u529f\uff01",140)};var s={cmtErr:"\u8bc4\u8bba\u5185\u5bb9\u4e0d\u80fd\u5c11\u4e8e3\u4e2a\u5b57\uff01",repyErr:"\u56de\u590d\u5185\u5bb9\u4e0d\u80fd\u5c11\u4e8e3\u4e2a\u5b57\uff01",subFail:"\u63d0\u4ea4\u5931\u8d25\uff01",notMine:"\u4e0d\u80fd\u5bf9\u81ea\u5df2\u56de\u590d\uff01",notrade:"\u4eb2\uff0c\u672a\u53c2\u4e0e\u4e91\u8d2d\u6682\u4e0d\u80fd\u53d1\u8868\u56de\u590d\u54e6\uff01"};var x=function(){var b=null;var e=function(){$("a","#GoToBuy").hover(function(){b=$(this).html();$(this).html("\u7acb\u5373\u53c2\u4e0e\u7b2c<span>"+$(this).find("span").html()+"</span>\u671f")},function(){if(b!=null){$(this).html(b)}})};e();var d=function(){var F="http://post.1yyg.com";var E=null;var C=$("#codeID").val();var j=1;var k=1;var l=6;var i=new Object();var D=function(y,z){var A="page="+y+"&size="+l+"&codeID="+C+"&iscount="+z;var B=function(T){if(T.code==0){if(z==1){if(T.count>0){if(E==null){var X=$('<div class="Comment_victory"><div class="victory-tit"><span><a href="javascript:void(0);" class="page-upgray"></a><a href="javascript:void(0);" class="page-updow"></a></span><h3>\u5176\u4ed6\u671f\u6570\u83b7\u5f97\u8005</h3></div><ul></ul></div>');$("#PostDetailRight").prepend(X);E=X.find("ul");var P=X.find("a.page-upgray");var S=X.find("a.page-updow");var R=function(){if(j>1){P.addClass("page-up")}else{P.removeClass("page-up")}if(j<k){S.addClass("page-dow")}else{S.removeClass("page-dow")}};P.click(function(){if(j>1){if(i["page"+(j-1)]!=null){E.html(i["page"+(j-1)])}else{D(j-1,0)}j-=1;R()}});S.click(function(){if(j<k){if(i["page"+(j+1)]!=null){E.html(i["page"+(j+1)])}else{D(j+1,0)}j+=1;R()}})}}var Q=parseInt(T.count);if(Q%l>0){k=parseInt(Q/l)+1}else{k=parseInt(Q/l)}if(k>1){S.addClass("page-dow")}}var W=T.data;var V="";V+="<ul>";for(var U=0;U<W.length;U++){V+='<li class="victory_info">';V+='<div class="victory_head"><a class="blue" href="http://u.1yyg.com/'+W[U].userWeb+'" title="'+W[U].userName+'" target="_blank"><img src="http://faceimg.1yyg.com/UserFace/'+W[U].userPhoto+'"></a></div>';V+='<p class="victory_User"><a class="blue" href="http://u.1yyg.com/'+W[U].userWeb+'" title="'+W[U].userName+'"  target="_blank">'+W[U].userSName+"</a>\u83b7\u5f97\u4e86\u7b2c"+W[U].codePeriod+"\u671f</p>";if(W[U].postID!="0"){V+='<p><a href="http://post.1yyg.com/Detail-'+W[U].postID+'.html" class="victory_detail" target="_blank">\u67e5\u770b\u6652\u5355</a></p>'}else{V+='<p><span class="gray03">\u6682\u672a\u6652\u5355</span></p>'}V+="</li>"}V+="</ul>";E.html(V);i["page"+j]=V}};GetJPData(F,"getPostOldPeriodList",A,B)};D(1,1)};d();var h=function(){var z=false;var i=$("#emHits");var l=$.cookie(p);var k=i.find("em");var j=k.html();if(l==null||l==""){l=","}if(l.indexOf(","+v+",")>=0){z=true;i.addClass("smile-have").find("b").html("\u5df2\u7fa1\u6155("+j+")")}else{i.unbind("click").bind("click",function(){if(z){return false}GetJPData("http://post.1yyg.com","InsertPostHits","postid="+v,function(B){if(B.code==0){l=l+v+",";$.cookie(p,l,{expires:1,path:"/"});z=true;i.addClass("smile-have").find("b").html("\u5df2\u7fa1\u6155("+(parseInt(j)+1)+")");var y=$("<div class='ts'>\u7fa1\u6155+1</div>");i.append(y);y.fadeTo(3000,0,function(){y.remove()})}else{h()}})})}i.parent().show()};var f=function(i){return i.replace(/&/ig,"&amp;").replace(/</ig,"&lt;").replace(/>/ig,"&gt;").replace(/\[(\/)?(b|br)\]/ig,"<$1$2>").replace(/\[s:(\d+)\]/ig,'<img src="http://skin.1yyg.com/Images/Emoticons/$1.gif" alt="" />').replace(/\[url=([^\]]*)\]([^\[]+)\[\/url\]/ig,'<a href="$1" target="_blank" class="blue">$2</a>').replace(/\s{2}/ig,"&nbsp;&nbsp;")};var a=function(z,l,j,i){if(z.prev("iframe").length>0){return null}var k=$('<iframe class="edit-iframe" hidefocus="true" frameborder="0" scrolling="no" src="about:blank"></iframe>');k.css({width:z.width(),height:z.height()}).attr("src","http://skin.1yyg.com/Editor/"+l+".htm?edit="+z.attr("id")+"&postdom="+i+(j==""?"":"&upurl="+j)+"");z.hide().before(k);k.ready(function(){});return k};var c=function(j,l){var k="/API/ValidImg.html";var i=function(){var J=getobj("btnCodeSubmit");var E=getobj("btnSetImg");var F=getobj("PDZshowimg");var H=getobj("PDTxtCode");var I=function(){F.attr("src",k+"?rnd="+GetRandomNum(1,10000));return false};E.bind("click",I);var G=getobj("PDShowErr");if(j==0){G.addClass("yzwrong").html("\u9a8c\u8bc1\u7801\u9519\u8bef\uff01").show();H.focus()}else{if(j==1){G.removeClass("yzwrong").html("&nbsp;&nbsp;\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801 ").show();H.focus()}}J.unbind("click").bind("click",function(){var y=H.val();if(y==""){G.addClass("yzwrong").show().html("\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801\uff01");H.focus()}else{l(y)}});H.keydown(function(y){if(y.keyCode==13){J.trigger("click")}})};$.PageDialog('<div class="auth_box" ><ul><li><input id="PDTxtCode" class="text_yzm" type="text" onpaste="return false;" maxlength="6" /><div id="PDShowErr" class="yzwrong" style="display:none;">\u9a8c\u8bc1\u7801\u9519\u8bef</div></li><li><img id="PDZshowimg"  src="'+k+"?rnd="+GetRandomNum(1,10000)+'" /><a id="btnSetImg" href="javascript:;"><u>\u770b\u4e0d\u6e05\uff0c\u6362\u4e00\u4e2a</u></a></li><li><a id="btnCodeSubmit" type="button" class="orangebut" href="javascript:void();"> \u786e \u5b9a</a></li></ul></div>',{W:260,H:160,title:"\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801",ready:i})};var g=function(){var K=new popLogin();var L="http://faceimg.1yyg.com/UserFace/";var J="00000000000000000.jpg";var F=$("#hidUserFace").val();var i=$("#bottomComment");var j=function(){i.find("a[name='replyLoginBtn']").click();q.find("input[name='replyDataState'][value='1']").val("2");q.find("div[name='Replybox']:visible").find("a[name='replyLoginBtn']").click()};var k=function(y){if(F!=J){return false}var z=function(A){if(A.code==1){F=A.userPhoto}y.append('<img name="imgUserPhoto" src="'+L+F+'" />')};GetJPData("http://api.1yyg.com","logininfo","",z)};var l=function(y,z){var A=u&&F==J;return'<div class="Comment_Reply clearfix">'+(A?'<div class="Comment-pic" name="userFace"></div>':'<div class="Comment-pic"><img name="imgUserPhoto" src="http://faceimg.1yyg.com/UserFace/'+F+'" /></div>')+'<div class="Comment_form"><div id="divCommTo" class="Comment-name" style="display:none;"></div><div class="Comment_textbox"><textarea id="replyTA'+y+z+'" name="replyTA" '+(u?'class="Comment-txt"':' class="hidden Comment-txt"')+"></textarea>"+(u?"":'<div id="notLogin" name="replyLogin" class="Comment_login" runat="server">\u8bf7\u60a8<a href="javascript:;" class="blue" name="replyLoginBtn">\u767b\u5f55</a>\u6216<a href="https://passport.1yyg.com/register.html?forward=rego" class="blue">\u6ce8\u518c</a>\u540e\u518d\u56de\u590d\u8bc4\u8bba</div>')+'<input type="button" id="btnReplyMsg'+y+z+'" name="btnReplyMsg" class="hidden" /></div></div></div>'};var H=function(D,C){var y=function(E,O){var P=$(a(E,"comment","",O));this.GetHtml=function(){try{return P.get(0).contentWindow.GetHtml()}catch(M){return""}};this.Reset=function(){try{return P.get(0).contentWindow.Reset()}catch(M){return""}};this.remove=function(){P.remove();E.show()}};var A=null;var z=$("input[name='btnReplyMsg']",D);z.bind("click",function(){C(A.GetHtml());return false});var B=$("textarea[name='replyTA']",D);B.show();A=new y(B,z.attr("id"))};var G=function(){var C=function(E){var N=false;if(E.length>0&&E.css("display")=="block"){N=true}return N};var A=function(E){return'<div class="Comment_Details"><div class="User_head"><a rel="nofollow" href="http://u.1yyg.com/'+E.userWeb+'" target="_blank" title="'+E.username+'"><img src="'+L+E.face+'" alt="" /></a></div><div name="replyBoxEX" class="Comment_info_one"><div class="Comment_User"><em>'+E.floor+'\u697c</em><span><a class="blue" href="http://u.1yyg.com/'+E.userWeb+'" target="_blank">'+E.username+"</a></span>"+(parseInt(E.reFloor)>0?(" \u56de\u590d "+E.reFloor+" \u697c"):"")+'</div><div class="C_summary">'+f(E.content)+'<span class="Summary-time">'+E.time+'</span><span class="Reply-r"><a class="blue" href="javascript:void(0);" name="'+(parseInt(E.isDel)==1?'signDelete" data='+E.replayId+">\u5220\u9664":'signReply">\u56de\u590d')+'</a></span></div></div><div class="qhackbox"></div></div>'};var z=function(E,U,T,R,V){var S=function(){var P=T.find("div[name='ReplyTextAreaEX']");if(P.length==0){var M='<div name="ReplyTextAreaEX" class="qcomment_reply_module">'+l("R",E)+"</div>";var O=$(M);T.find("div[name='replyBoxEX']").append(O);var N=O.find("div[name='userFace']");if(N.length>0){k(N)}var Q=function(aa){if(!isLoaded){return false}if(aa.length<3){FailDialog(s.repyErr,210);return false}var Z={action:"InsertPostReply",postid:v,originalContent:aa,code:"",refReplyId:E,refFloor:U};var ab=function(){$.post("http://post.1yyg.com/JPData",Z,function(X){if(X.code==0){o();R.next("input").val("0");R.children("b").html(parseInt(R.children("b").html())+1);O.remove();isLoaded=true;B(R,E,V)}else{if(X.code==10){u=false;PagePOPLoginOK=function(){u=true;ab();K.hide();return false};K.show()}else{if(X.code==3){var W=function(Y){Z.code=Y;ab()};c(X.Num,W)}else{if(X.code==4){FailDialog(s.repyErr,210)}else{if(X.code==5){FailDialog(s.notMine,176)}else{if(X.code==6){FailDialog(s.notrade,300)}else{FailDialog(s.subFail,140)}}}}}}},"json")};ab()};H(O,Q)}else{if(P.css("display")=="none"){P.removeClass("hidden")}else{P.addClass("hidden")}}};if(u){S()}else{u=false;PagePOPLoginOK=function(){u=true;j();S();K.hide();return false};K.show()}};var D=function(O,E){if(!isLoaded){return false}var P=function(){var N="replyId="+O;var M=function(R){if(R.code==0){isLoaded=true;E()}else{FailDialog("\u5220\u9664\u5931\u8d25\uff01",140)}};GetJPData("","DeletePostReply",N,M)};ConfirmDialog("\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f",P)};var B=function(S,E,X){var U=parseInt(S.children("b").html());var V=S.next("input");if(C(X)&&V.val()=="1"){X.hide()}else{var T=function(){var M=X.find("div[name='ReplyForm']");var O=$(l("C",E));M.empty().append(O);var N=O.find("div[name='userFace']");if(N.length>0){k(N)}X.show();if(u){var P=function(R){if(!isLoaded){return false}if(R.length<3){FailDialog(s.repyErr,210);return false}var Q={action:"InsertPostReply",postid:v,originalContent:R,code:"",refReplyId:E,refFloor:0};var Z=function(){$.post("http://post.1yyg.com/JPData",Q,function(ab){if(ab.code==0){o();S.next("input").val("0");S.children("b").html(U+1);isLoaded=true;B(S,E,X)}else{if(ab.code==2){u=false;PagePOPLoginOK=function(){u=true;Z();K.hide();return false};K.show()}else{if(ab.code==3){var Y=function(aa){Q.code=aa;Z()};c(ab.Num,Y)}else{if(ab.code==4){FailDialog(s.repyErr,210)}else{if(ab.code==5){FailDialog(s.notMine,176)}else{if(ab.code==6){FailDialog(s.notrade,300)}else{FailDialog(s.subFail,140)}}}}}}},"json")};Z()};H(O,P)}else{O.find("a[name='replyLoginBtn']").bind("click",function(){var Q=function(){V.val("2");X.hide();B(S,E,X)};if(u){Q()}else{PagePOPLoginOK=function(){u=true;j();K.hide();return false};K.show()}})}};if(V.val()=="0"){T();var W=function(N){var R=X.find("div[name='ReplyList']");if(N.code==0){var P=S.children("b");R.empty();var O=N.data;$.each(O,function(aj,ag){var ai=O[aj].replyID;var ae=O[aj].floorID;var af={username:O[aj].replyUserName,userWeb:O[aj].replyUserWeb,face:O[aj].userPhoto,floor:ae,reFloor:O[aj].replyRefFloor,isDel:O[aj].isDel,time:O[aj].replyTime,content:O[aj].replyContent,replayId:ai};var ah=$(A(af));ah.find("a[name='signReply']").bind("click",function(){z(E,ae,$(this).parents(".Comment_Details"),S,X);return false});ah.find("a[name='signDelete']").bind("click",function(){var Y=function(){V.val("0");var Z=parseInt(P.html())-1;P.html(Z);B(S,E,X)};D($(this).attr("data"),Y);return false});R.append(ah)})}else{R.empty()}V.val("1");X.show();var M=S.offset();var Q=$(window).scrollTop();if(Q>M.top){$("body,html").animate({scrollTop:M.top-40},500)}};GetJPData("","GetPostReplyInfo","replyId="+E,W)}else{if(V.val()=="2"){V.val("1");T()}else{X.show()}}}};var y=function(){this.TotalCount=0;this.PageMax=10;this.CurrentIndex=1;var P={FIdx:1,EIdx:this.PageMax,isCount:1,postid:v};var E=function(){if(!isLoaded){return false}var M=function(V){if(V.code==0){if(P.isCount==1){CBLFun.TotalCount=V.count}var U=$("<ul/>");q.empty().append(U);if(CBLFun.TotalCount>0){var T=V.data;$.each(T,function(R,ad){var aa=T[R].replyID;var ag=T[R].replyCount;var ae='<li class="Comment_single"><div class="Comment_box_con clearfix"><div class="User_head"><a rel="nofollow" href="http://u.1yyg.com/'+T[R].replyUserWeb+'" target="_blank" title="'+T[R].replyUserName+'"><img src="'+L+T[R].userPhoto+'" alt="" /></a></div><div class="Comment_con"><div class="Comment_User"><span><a class="blue" href="http://u.1yyg.com/'+T[R].replyUserWeb+'" target="_blank">'+T[R].replyUserName+'</a></span></div><div class="C_summary">'+f(T[R].replyContent)+'<span class="Summary-time">'+T[R].replyTime+'</span><span class="Reply-r"><a class="blue signReplay" href="javascript:;">\u56de\u590d(<b>'+ag+'</b>)</a><input name="replyDataState" type="hidden" value="0" /></span></div></div><div name="Replybox" class="qcomment_box_reply" style="display: none;"><div class="qcomment_box_reply_topbj"></div><div name="ReplyForm" class="qcomment_reply_module"></div><div name="ReplyList" class="qcomment_reply_list_module"></div><div class="Comment_Collapse"><a href="#">\u6536\u8d77<b></b></a></div></div><div class="qhackbox"></div><div class="qcomment_box_bottom"></div></div></li>';var ac=$(ae);U.append(ac);var S=ac.find(".Comment_Collapse");if(parseInt(ag)>0){S.bind("click",function(){ac.find(".qcomment_box_reply").hide();return false})}else{S.hide()}var Q=ac.find("div[name='Replybox']");var af=ac.find("a.signReplay");af.bind("click",function(){var X=$(this);X.parents("li.Comment_single").siblings().find("div[name='Replybox']:visible").hide();var W=X.offset();var Y=$(window).scrollTop();if(Y>W.top){$("body,html").animate({scrollTop:W.top-40},500)}B(X,aa,Q);return false})});if(CBLFun.TotalCount>CBLFun.PageMax){q.append('<div id="cmtPageNav" class="pages">'+GetAjaxPageNationEx2(CBLFun.TotalCount,CBLFun.PageMax,5,CBLFun.CurrentIndex,"CBLFun.gotoPageIndex",false,true)+"</div>")}}}};var N="FIdx="+P.FIdx+"&EIdx="+P.EIdx+"&postid="+v;GetJPData("","getPostReplyByID",N,M)};var O=function(N,M){CBLFun.CurrentIndex=Math.floor(M/CBLFun.PageMax);P.FIdx=N;P.EIdx=M;if(CBLFun.CurrentIndex>1){P.isCount=0}else{P.isCount=1}E()};this.gotoPageIndex=function(N,M){O(N,M);var R=$("#bottomComment").offset().top;$("body,html").animate({scrollTop:R},500)};this.initData=function(){O(1,CBLFun.PageMax)};this.TotalCountAdd=function(M){CBLFun.TotalCount+=M}};CBLFun=new y();CBLFun.initData()};var I=function(){var y=function(){var C=$(l("M",0));i.empty().append(C);var B=C.find("div[name='userFace']");if(B.length>0){k(B)}var D=function(O){if(!isLoaded){return false}if(O.length<3){FailDialog(s.cmtErr,210);return false}var E={action:"InsertPostReply",postid:v,originalContent:O,code:"",refReplyId:0,refFloor:0};var P=function(){$.post("http://post.1yyg.com/JPData",E,function(N){if(N.code==0){o();y();isLoaded=true;var M=parseInt(w.html())+1;w.html(M);if(M==1){q.show();G()}else{CBLFun.initData()}}else{if(N.code==2){u=false;PagePOPLoginOK=function(){u=true;P();K.hide();return false};K.show()}else{if(N.code==3){var R=function(Q){E.code=Q;P()};c(N.Num,R)}else{if(N.code==4){FailDialog(s.cmtErr,210)}else{if(N.code==5){FailDialog(s.notMine,176)}else{if(N.code==6){FailDialog(s.notrade,300)}else{FailDialog(s.subFail,140)}}}}}}},"json")};P()};H(C,D)};if(u){y()}else{var A=$(l("M",0));var z=A.find("div[name='userFace']");if(z.length>0){k(z)}A.find("a[name='replyLoginBtn']").bind("click",function(){var B=function(){y()};if(u){B()}else{PagePOPLoginOK=function(){u=true;j();K.hide();return false};K.show()}return false});i.empty().append(A)}};isLoaded=true;h();I();if(parseInt(w.html())>0){q.show();G()}};Base.getScript(m+"/JS/popLogin.js?date=20140509",g)};Base.getScript(m+"/JS/AjaxFun.js?date=20130123",x);var t=function(){ShareTitle=document.title;var b=function(){Base.getScript(m+"/JS/BDShare.js?date=20120428")};var c=$.cookie("uid");if(c!=null&&parseInt(c)>0){var d=function(){return escape("http://www.1yyg.com/api/referrals.ashx?rid="+c+"&url="+escape(location.href+"?s=share-u"+c+"p"))};var a=function(e){if(e.code==1&&e.data.urls[0].result){ShareUrl=e.data.urls[0].url_short.replace("t.cn","t.1yyg.com");b()}};$.getJSON("https://api.weibo.com/2/short_url/shorten.json?source=1681459862&url_long="+d()+"&callback=?",a)}else{ShareUrl=location.href+"?s=shared";b()}};t()});

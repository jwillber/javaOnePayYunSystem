var _Ptn=/^\d+$/;var PagePOPLoginOK=null;var _IsLoadLoginJS=false;var _UserBalance=0;var _GotoPayPage=false;var _IsLogined=true;var _IsLoadPlJs=false;$.fn.GoodsItemFun=function(){var f=$(this);var e=f.attr("codeID");f.hover(function(){var b=$(this);var a=1;if(parseInt(b.attr("idx"))%4==0){a=0;b.removeClass("soon-list4").addClass("soon-list-hover2")}b.addClass("soon-list-hover");if(!_IsLogined){return}var c=b.children("div.u_buyCount");if(c.html()==""){}else{if(c.html()!="&nbsp;"){c.show()}}},function(){if(parseInt($(this).attr("idx"))%4==0){$(this).addClass("soon-list4").removeClass("soon-list-hover2")}$(this).removeClass("soon-list-hover").children("div.u_buyCount").hide()});var d=f.find("img[name='goodsImg']");f.find("li[name='buyBox']").GoodsBuyFun(d,e)};$.fn.GoodsCountFun=function(b){var k=$(this).children("input");var c=parseInt(k.attr("surplus"));var l=k.prev();var j=k.next();var r=$("#btnConfirmBuy");var p=$("#pageDialogMain");var e=$("#pageDialogClose");var i=k.parent().next();var q=function(u){if(u==""){i.attr("class","u-popup-Tip grayb").show().html("\u8bf7\u9009\u62e9"+$shortName+"\u4eba\u6b21")}else{i.attr("class","u-popup-Tip orange").show().html(u)}};var s=i.next("div.u-popup-paytip");var f=function(v,u){_GotoPayPage=true;s.show().find("span.orange").html(v+".00");r.html("\u4f7f\u7528\u5176\u5b83\u65b9\u5f0f\u652f\u4ed8");p.css("height",u+"px")};var d=1;var o=function(u){d=u;k.val(u);if(_UserBalance>0){if(u>_UserBalance){f(u,300)}else{_GotoPayPage=false;s.hide();p.css("height","240px");r.html('\u786e\u8ba4\u652f\u4ed8<span class="mlr5">'+u+".00</span>\u5143")}}else{f(u,300)}};k.keyup(function(v){var u=k.val();if(u==""){q("<s></s>\u6700\u5c11\u9700"+$shortName+"1\u4eba\u6b21");o(1)}else{if(!_Ptn.test(u)){q("");o(d)}else{if(u==0){q("<s></s>\u6700\u5c11\u9700"+$shortName+"1\u4eba\u6b21");o(1)}else{if(u<=c){if(u>100){q("<i></i>\u5df2\u8d85\u8fc7100\u4eba\u6b21\uff0c\u8c28\u614e\u53c2\u4e0e\u54e6\uff01</span>")}else{q("")}o(u)}else{q("<s></s>\u6700\u591a\u80fd"+$shortName+c+"\u4eba\u6b21");o(c)}}}}if(d==1){l.addClass("num_ban");j.removeClass("num_ban")}else{if(d==c){l.removeClass("num_ban");j.addClass("num_ban")}else{l.removeClass("num_ban");j.removeClass("num_ban")}}}).keydown(function(u){if(13==((window.event)?event.keyCode:u.keyCode)){h()}}).mouseover(function(){$(this).focus().select()}).val("1").select().focus();l.click(function(){var u=k.val();if(_Ptn.test(u)){var v=parseInt(u);if(v>1){q("");v--;if(v>100){q("<i></i>\u5df2\u8d85\u8fc7100\u4eba\u6b21\uff0c\u8c28\u614e\u53c2\u4e0e\u54e6\uff01</span>")}else{q("")}o(v);if(v==1){l.addClass("num_ban")}j.removeClass("num_ban")}else{}}return false});j.click(function(){var u=k.val();if(_Ptn.test(u)){var v=parseInt(u);if(v<c){q("");v++;if(v>100){q("<i></i>\u5df2\u8d85\u8fc7100\u4eba\u6b21\uff0c\u8c28\u614e\u53c2\u4e0e\u54e6\uff01</span>")}else{q("")}o(v);l.removeClass("num_ban");if(v==c){j.addClass("num_ban")}}else{}}return false});$("body").keydown(function(u){if($("#divSuccMain").length>0&&13==((window.event)?event.keyCode:u.keyCode)){$.PageDialog.close()}});var g=function(){var u='<div class="content"><div id="divSuccMain" class="g-popup"><div class="g-pay-tip"><s class="f-pay-succeed"></s><p class="f-pay-tit gray6">\u652f\u4ed8\u6210\u529f\uff01</p><p class="gray9">\u8bf7\u8fdb\u5165\uff02<a href="/user/UserBuyList.html" target="_blank" class="gray6">\u6211\u7684'+$shortName+"\u8bb0\u5f55</a>\uff02\u67e5\u770b"+$shortName+'\u7801</p><p class="f-pay-btn"><a id="btnClose" href="javascript:;" class="orange_btn">\u7ee7\u7eed'+$shortName+"</a></p></div></div></div>";p.html(u);$("#btnClose").unbind("click").click(function(v){if(v&&v.stopPropagation){v.stopPropagation()}else{window.event.cancelBubble=true}$.PageDialog.close()})};var n=function(){var u='<div class="content"><div class="g-popup"><div class="g-pay-tip"><s class="f-pay-fail"></s><p class="f-pay-tit gray6">'+$shortName+'\u5931\u8d25\uff01</p><p class="gray9">\u88ab\u62a2\u5149\u4e86\uff0c\u60a8\u4e0b\u624b\u592a\u6162\u4e86\uff01</p><p class="f-pay-btn"><a id="btnClose" href="javascript:;" class="orange_btn">\u786e \u8ba4</a></p></div></div></div>';p.html(u);$("#btnClose").unbind("click").click(function(){$.PageDialog.close();location.reload()})};var t=function(){var u='<div class="content"><div class="g-popup"><div class="g-pay-tip"><s class="f-pay-fail"></s><p class="f-pay-tit gray6">'+$shortName+'\u5931\u8d25\uff01</p><p class="gray9">\u5f88\u62b1\u6b49\uff0c\u8d2d\u4e70\u5931\u8d25\u4e86\uff01</p><p class="f-pay-btn"><a id="btnClose" href="javascript:;" class="orange_btn">\u786e \u8ba4</a></p></div></div></div>';p.html(u);$("#btnClose").unbind("click").click(function(){$.PageDialog.close();location.reload()})};var a=function(){var u='<div class="content"><div class="g-popup"><div class="g-pay-tip"><s class="f-pay-fail"></s><p class="f-pay-tit gray6">\u63d0\u4ea4\u5931\u8d25\uff01</p><p class="gray9">\u63d0\u4ea4\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\uff01</p><p class="f-pay-btn"><a id="btnClose" href="javascript:;" class="orange_btn">\u786e \u8ba4</a></p></div></div></div>';p.html(u);$("#btnClose").unbind("click").click(function(){$.PageDialog.close()})};var m=$("#buyBox");var h=function(){if(parseInt(d)>0){$.ajax({url:"/list/isStatus.action?id="+b,type:"GET",success:function(data){if(data=="false"){n()}else{if(_GotoPayPage){var count=parseInt(d);var codeid=b;var json=getCookie("products");if(json==null||json==""){var val="[{'pId':"+codeid+",'num':"+d+"}]";SetCookieByExpires("products",val,1)}else{var flag=false;json=eval("("+json+")");$.each(json,function(n,value){if(codeid==value.pId){value.num=(parseInt(value.num)+parseInt(d));if((parseInt(value.num)+parseInt(d))>count){value.num=count}flag=true}});if(!flag){json.push({pId:+codeid,num:d})}json=JSON.stringify(json);SetCookieByExpires("products",json,1)}location.href="/mycart/payment.html"}else{if(_IsBuySubmiting){return}_IsBuySubmiting=true;p.css("height","225px");m.attr("class","g-submit").html('<p class="f-submit-tit gray6">\u6b63\u5728\u63d0\u4ea4\uff0c\u8bf7\u7a0d\u5019...</p><div class="u-progress u-progress-c3"><span class="pgbar" style="width:100%"><span class="pging"></span></span></div>');e.hide();var x=0;if(x==0){var w=function(){$.ajax({url:"/mycart/getShopResult.action?id="+b+"&moneyCount="+d,type:"GET",success:function(data){if(data=="success"){_IsCartChanged=true;g();var D=$("#ulGoodsList").find('div[codeid="'+b+'"]');var G=D.find("li.g-progress");var A=G.find("span.orange").children("em");var E=parseInt(A.html())+parseInt(d);A.html(E);A=G.find("span.gray6").children("em");var H=parseInt(A.html());A=G.find("span.blue").children("em");var F=parseInt(A.html())-parseInt(d);A.html(F);var J=parseFloat(E)/H;var I=$(window).width()<1190?217:266;var C=parseInt(J*I);A=G.find("dl.m-progress").children("dt");A.attr("title","\u5df2\u5b8c\u6210"+formatFloat(J*100)+"%").html('<b style="width:'+(parseInt(C)==0?1:C)+'px;"></b>');A=D.children("div.u_buyCount");if(A.length>0){A.find("em").html(parseInt(A.find("em").html())+parseInt(d))}else{var z=1;if(parseInt(D.attr("idx"))%4==0){z=0}var y=D.width()-z;A.width(y+"px").html("<p></p><h3>\u672c\u671f\u60a8\u5df2\u53c2\u4e0e<em>"+d+"</em>\u4eba\u6b21</h3>")}e.show()}else{if(data=="over"){setTimeout(n,2000);location.reload()}else{setTimeout(t,2000);location.reload()}}_IsBuySubmiting=false},error:function(){a()}})};setTimeout(w,3000)}else{if(10==10){location.reload()}else{a()}e.show();_IsBuySubmiting=false}}}},error:function(){a()}})}else{k.focus().select()}};r.click(function(){h();return true}).hover(function(){if(!_GotoPayPage){}},function(){})};$.fn.GoodsBuyFun=function(b,a){var c=$(this);c.children("a").eq(0).click(function(){var e=function(g){_UserBalance=g;_GotoPayPage=false;var j=parseInt(c.prev("li.g-progress").find("span.blue em").html());if(j>0){var f='<div class="g-popup"><div class="g-buy-frame"><div id="buyBox" class="m-popup-buy"><p class="u-popup-remaining gray9">\u5269\u4f59 '+j+' \u4eba\u6b21</p><div id="divNumber" class="u-popup-number gray6"><label>\u6211\u8981'+$shortName+'</label><a href="javascript:void();" class="num_del num_ban" id="num_del">-</a><input id="i_num" type="text" value="1" maxlength="7" surplus="'+j+'" class="num_dig"><a href="javascript:void();" class="num_add" id="num_add">+</a><label>\u4eba\u6b21</label></div><p class="u-popup-Tip grayb">\u8bf7\u9009\u62e9'+$shortName+'\u4eba\u6b21</p><div class="u-popup-paytip" style="display:'+(_UserBalance>0?"none":"")+'"><p class="u-popup-paymoney gray3">\u603b\u9700\u652f\u4ed8<span class="orange FB">1.00</span>\u5143</p><p class="u-popup-payRecharge gray6">\u60a8\u7684\u5e10\u6237\u4f59\u989d\u4e0d\u8db3\uff0c<a href="/user/UserRecharge.html" target="_blank" class="blue">\u7acb\u5373\u5145\u503c <span>&gt;&gt;</span></a></p></div><p class="u-popup-balance gray9">\u60a8\u7684\u5e10\u6237\u4f59\u989d\uff1a <span class="gray6">'+g+'.00</span><span class="mlr5">\u5143</span></p><div class="arrow_boxj" style="display:none;"><div class="arrow_box"><span class="arrow_dq"></span>\u786e\u8ba4\u652f\u4ed8\u540e\u5c06\u76f4\u63a5\u4ece\u60a8\u7684\u8d26\u6237\u4e2d\u6263\u9664\uff01</div></div><div class="m-popup_buybtn"><a id="btnConfirmBuy" href="javascript:;" class="orange_btn">'+(_UserBalance>0?'\u786e\u8ba4\u652f\u4ed8<span class="mlr5">1.00</span>\u5143':"\u4f7f\u7528\u5176\u5b83\u65b9\u5f0f\u652f\u4ed8")+"</a></div></div></div></div>";var i=240;if(_UserBalance<1){_GotoPayPage=true;i=300}$.PageDialog(f,{W:435,H:i,BShow:false,ready:function(){$("#divNumber").GoodsCountFun(a)}})}else{var h='<div class="g-popup"><div class="g-pay-tip"><s class="f-pay-fail"></s><p class="f-pay-tit gray6">'+$shortName+'\u5931\u8d25\uff01</p><p class="gray9">\u88ab\u62a2\u5149\u4e86\uff0c\u60a8\u4e0b\u624b\u592a\u6162\u4e86\uff01</p><p class="f-pay-btn"><a id="btnClose" href="javascript:;" class="orange_btn">\u786e \u8ba4</a></p></div></div>';$.PageDialog(h,{W:435,H:225,BShow:false,ready:function(){$("#btnClose").click(function(){$.PageDialog.close();location.reload()})}})}};var d=function(){var userId=getCookie("userId");var f=function(){var h=new popLogin();PagePOPLoginOK=function(){h.hide();d()};h.show()};if(userId!=null){$.ajax({url:"/getIndexUserInfo.action?id="+userId,success:function(data){if(data!=null){e(data.userBalance)}else{if(_IsLoadLoginJS){f()}else{$.getScript("/js/poplogin.js",function(){_IsLoadLoginJS=true;f()})}}}})}else{$.getScript("/js/poplogin.js",function(){_IsLoadLoginJS=true;f()})}};d();return false});$(this).children("a").eq(1).click(function(){var e=$(this);var d=function(g){$.PageDialog('<div class="mAltFail"><s></s>'+g+"</div>",{W:150,H:60,close:false,autoClose:true,submit:function(){location.reload()}})};var f=function(){var g=function(){showParabola(e,1,b,function(){var l=e.parent().prev("li.g-progress");var k=b.attr("src");k=k.substring(k.lastIndexOf("/productImg/"));var h=1;var j=l.find("span.blue em").text();var i=e.parent().prevAll("li.g-soon-pic").find("a").attr("title");_InsertIntoCart(a,k,h,j,i)})};if(_IsLoadPlJs){g()}else{$.getScript("/js/parabola.js",function(){_IsLoadPlJs=true;g()})}};$.ajax({url:"/list/isStatus.action?id="+a,type:"GET",success:function(data){if(data=="false"){d("\u5546\u54c1\u5df2\u88ab\u62a2\u5149\u4e86\uff01")}else{_IsCartChanged=true;var count=parseInt(data);var codeid=a;var json=getCookie("products");if(json==null||json==""){var val="[{'pId':"+codeid+",'num':"+1+"}]";SetCookieByExpires("products",val,1)}else{var flag=false;json=eval("("+json+")");$.each(json,function(n,value){if(codeid==value.pId){value.num=(parseInt(value.num)+parseInt(1));if((parseInt(value.num)+parseInt(1))>count){value.num=count}flag=true}});if(!flag){json.push({pId:+codeid,num:1})}json=JSON.stringify(json);SetCookieByExpires("products",json,1)}f()}},error:function(){d("\u5546\u54c1\u6dfb\u52a0\u5931\u8d25\uff01")}});return false})};var getListPaging=function(n,o,l,i,s){var r=1,m=1,p=1;var t="";r=parseInt(n/o);if(n%o>0){r++}if(r<1){r=1}t+='<div class="g-pagination w1190">';if(n>0){m=1;while(m+i<r+1&&m+i<l+2){m+=i-2}p=m+i-1;if(p>r){p=r}if(l==1){t+='<span class="f-noClick"><a title="\u4e0a\u4e00\u9875" href="javascript:;"><i class="f-tran f-tran-prev">&lt;</i>\u4e0a\u4e00\u9875</a></span>'}else{t+='<span><a title="\u4e0a\u4e00\u9875" href="'+s(l-1)+'"><i class="f-tran f-tran-prev">&lt;</i>\u4e0a\u4e00\u9875</a></span>'}if(m>1){t+='<span><a href="'+s(1)+'">1</a></span><span>\u2026</span>'}for(var q=m;q<=p;q++){if(q!=l){t+='<span><a href="'+s(q)+'">'+q+"</a></span>"}else{t+='<span class="current"><a>'+q+"</a></span>"}}if(p<r){t+='<span>\u2026</span><span><a href="'+s(r)+'">'+r+"</a></span>"}if(l<r){t+='<span><a href="'+s(l+1)+'">\u4e0b\u4e00\u9875<i class="f-tran f-tran-next">&gt;</i></a></span>'}else{t+='<span class="f-noClick"><a>\u4e0b\u4e00\u9875<i class="f-tran f-tran-next">&gt;</i></a></span>'}}t+='<span class="f-mar-left">\u5171<em>'+r+"</em>\u9875\uff0c\u53bb\u7b2c</span>";t+='<span><input type="text" value="'+l+'">\u9875</span>';t+='<span class="f-mar-left"><a id="btnGotoPage" href="javascript:;" title="\u786e\u5b9a">\u786e\u5b9a</a></span>';t+="</div>";return t};

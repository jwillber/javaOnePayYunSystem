$(document).ready(function(){var resultCount=$("#resultCount").val();var pageNo=0;var userId=$("#userId").val();var M=$("#goods_list");var O=$("[name=divTip]");var p=$("<ul></ul>");var X=$("#txtMisTime");var F=$("#txtMaxTime");var N=$("#btnSearch");var W=$("[class=record-cur]").attr("name");var a=new Date();var startDate=X.val();var endDate=F.val();$(".record-tab a").each(function(D,C){$(this).bind("click",function(){$(this).addClass("record-cur").siblings().removeClass("record-cur");W=$("[class=record-cur]").attr("name");$("#goods_list").empty();selectTime(W)})});$("#pagination").pagination(resultCount,{current_page:pageNo,prev_text:"\u4e0a\u4e00\u9875",next_text:"\u4e0b\u4e00\u9875",num_display_entries:5,num_edge_entries:1,link_to:"",prev_show_always:false,next_show_always:false,items_per_page:5,callback:pageselectCallback});function pageselectCallback(pageNo){var url="/user/userBuyListAjaxPage.action?pageNo="+pageNo+"&userId="+userId+"&selectTime="+W+"&startDate="+startDate+"&endDate="+endDate;$(".pageULEx").prepend('<li class="total_page" id="pageLoading"><img src="'+$img+'/Images/loding.gif" /></li>');$.ajax({url:url,type:"post",data:"json",beforeSend:loading,success:function(data){$("#goods_list").empty();if(resultCount>0){$('<ul class="gtitle"><li>\u5546\u54c1\u56fe\u7247</li><li class="gname">\u5546\u54c1\u540d\u79f0</li><li class="yg_status">'+$shortName+'\u72b6\u6001</li><li class="joinInfo">\u53c2\u4e0e\u4eba\u6b21/'+$shortName+'\u7801</li><li class="do">\u64cd\u4f5c</li></ul>').appendTo("#goods_list");$(".pageULEx").show();$(".pageULEx").prepend('<li class="total_page">\u9875\u6b21<i>'+(pageNo+1)+"/"+Math.ceil(resultCount/5)+"</i>&nbsp;&nbsp;\u5171<i>"+resultCount+"</i>\u6761\u8bb0\u5f55</li>");for(var i=0;i<data.length;i++){if(data[i].buyStatus=="0"){var K=parseInt(data[i].productPrice)-parseInt(data[i].spellbuyCount);var H=parseFloat(data[i].spellbuyCount)/parseFloat(data[i].productPrice);var E=206*H;E=(E<1&&parseInt(data[i].spellbuyCount)>0)?1:E;$('<ul class="goods_list"><li><a href="'+$www+"/products/"+data[i].productId+'.html" class="pic" target="_blank" title=""><img src="'+$img+data[i].productImg+'"></a></li><li class="gname"><a class="blue" href="'+$www+"/products/"+data[i].productId+'.html" target="_blank">(\u7b2c'+data[i].productPeriod+"\u671f)"+data[i].productName+'</a><p class="gray02">\u4ef7\u503c\uff1a<span class="money"><i class="rmb"></i>'+data[i].productPrice+'.00</span></p><div class="Progress-bar"><p><span style="width: '+E+'px"></span></p><ul class="Pro-bar-li"><li class="P-bar01"><em>'+data[i].spellbuyCount+'</em>\u5df2\u53c2\u4e0e\u4eba\u6b21</li><li class="P-bar02"><em>'+data[i].productPrice+'</em>\u603b\u9700\u4eba\u6b21</li><li class="P-bar03"><em>'+K+'</em>\u5269\u4f59\u4eba\u6b21</li></ul></div></li><li class="yg_status"><span class="green">\u6b63\u5728\u8fdb\u884c\u2026\u2026</span><br><a class="gray01" name="appendBuy" href="JavaScript:;">\u8ffd\u52a0'+$shortName+'\u4eba\u6b21</a><div style="display:none;" class="add"><dl><input type="hidden" value="'+K+'"><dd><input type="text" value="" class="amount" onpaste="return false" title="\u8d2d\u4e70\u4eba\u6b21"></dd><dd><a href="JavaScript:;" class="jia"></a><a href="JavaScript:;" class="jian"></a></dd><dd><input type="hidden" value="'+data[i].productId+'"><input type="button" name="btnAppendBuy" value="\u786e \u5b9a" class="orangebut btn29" title="\u8ffd\u52a0'+$shortName+'\u4eba\u6b21"></dd></dl></div></li><li buynum="'+data[i].buyCount+'" codeid="'+data[i].productId+'" class="joinInfo"><p><em>'+data[i].buyCount+'</em>\u4eba\u6b21</p><div class="joinInfo-Pop"><div class="grhead-join gray01" name="divTip" style="display: block;">\u6240\u6709'+$shortName+'\u7801<b></b></div><div style="display: none;" class="grhead-joinC" name="divShowRNO"><div class="grhead-joinCT gray01">\u6240\u6709'+$shortName+'\u7801<b></b></div><div class="grhead-joinClist" name="divRNOList"></div></div></div></li><li class="do"><a title="\u8be6\u60c5" class="blue" href="'+$www+"/user/UserBuyDetail-"+data[i].productId+'.html">\u8be6\u60c5</a></li></ul>').appendTo("#goods_list")}else{if(data[i].buyStatus=="2"){$('<ul class="goods_list"><li><a href="'+$www+"/products/"+data[i].productId+'.html" class="pic" target="_blank" title=""><img src="'+$img+data[i].productImg+'"></a></li><li class="gname"><a class="blue" href="'+$www+"/products/"+data[i].productId+'.html" target="_blank">(\u7b2c'+data[i].productPeriod+"\u671f)"+data[i].productName+'</a><p class="gray02">\u83b7\u5f97\u8005\uff1a\u6b63\u5728\u63ed\u6653</p><p class="gray02">\u63ed\u6653\u65f6\u95f4\uff1a\u6b63\u5728\u63ed\u6653</p></li><li class="yg_status"><span class="orange">\u6b63\u5728\u63ed\u6653</span></li><li buynum="'+data[i].buyCount+'" codeid="'+data[i].productId+'" class="joinInfo"><p><em>'+data[i].buyCount+'</em>\u4eba\u6b21</p><div class="joinInfo-Pop"><div class="grhead-join gray01" name="divTip">\u6240\u6709'+$shortName+'\u7801<b></b></div><div style="display:none;" class="grhead-joinC" name="divShowRNO"><div class="grhead-joinCT gray01">\u6240\u6709'+$shortName+'\u7801<b></b></div><div class="grhead-joinClist" name="divRNOList"></div></div></div></li><li class="do"><a title="\u8be6\u60c5" class="blue" href="'+$www+"/user/UserBuyDetail-"+data[i].productId+'.html">\u8be6\u60c5</a></li></ul>').appendTo("#goods_list")}else{$('<ul class="goods_list"><li><a href="'+$www+"/products/"+data[i].productId+'.html" class="pic" target="_blank" title=""><img src="'+$img+data[i].productImg+'"></a></li><li class="gname"><a class="blue" href="'+$www+"/products/"+data[i].productId+'.html" target="_blank">(\u7b2c'+data[i].productPeriod+"\u671f)"+data[i].productName+'</a><p class="gray02">\u83b7\u5f97\u8005\uff1a<a class="blue" target="_blank" href="'+$www+"/u/"+data[i].winUserId+'.html">'+data[i].winUser+'</a></p><p class="gray02">\u63ed\u6653\u65f6\u95f4\uff1a'+data[i].winDate+'</p></li><li class="yg_status"><span class="orange">\u5df2\u63ed\u6653</span></li><li buynum="'+data[i].buyCount+'" codeid="'+data[i].productId+'" class="joinInfo"><p><em>'+data[i].buyCount+'</em>\u4eba\u6b21</p><div class="joinInfo-Pop"><div class="grhead-join gray01" name="divTip">\u6240\u6709'+$shortName+'\u7801<b></b></div><div style="display:none;" class="grhead-joinC" name="divShowRNO"><div class="grhead-joinCT gray01">\u6240\u6709'+$shortName+'\u7801<b></b></div><div class="grhead-joinClist" name="divRNOList"></div></div></div></li><li class="do"><a title="\u8be6\u60c5" class="blue" href="'+$www+"/user/UserBuyDetail-"+data[i].productId+'.html">\u8be6\u60c5</a></li></ul>').appendTo("#goods_list")}}}$("#pageLoading").hide();$("a[name='appendBuy']",M).click(function(N){$(this).parent().parent().siblings().each(function(){$(this).find(".add").hide();$(this).find("a[name='appendBuy']").show()});$(this).parent().find(".add").show().click(function(O){f(O)});$(this).parent().find("input[type=text]").focus().val("1").select();$(this).hide();f(N)});$(".amount",M).mouseover(function(){$(this).focus().select()}).keydown(function(O){if(13==((window.event)?event.keyCode:O.keyCode)){var N=$(this).parent().parent().find("input[type=button]");h(N,O)}f(O)});$(".jia",M).click(function(){var N=$(this).parent().parent().find("input[type=text]");if(isNaN(parseInt(N.val()))){return}u("add",$(this))});$(".jian",M).click(function(){var O=$(this).parent().parent().find("input[type=text]");var N=O.val();if(isNaN(parseInt(N))||N=="0"){O.focus().select();return}u("sub",$(this))});$("input[name='btnAppendBuy']",M).click(function(N){h($(this),N)});$(".joinInfo",M).hover(function(){var Q=$(this);Q.find("div[name='divTip']").hide();Q.find("div[name='divShowRNO']").show();var N=Q.attr("codeID");var O=Q.attr("buyNum");var P=Q.find("div[name='divRNOList']");e(P,N,O)},function(){$(this).find("div[name='divTip']").show();$(this).find("div[name='divShowRNO']").hide();p.remove()})}else{$('<ul class="gtitle"><li>\u5546\u54c1\u56fe\u7247</li><li class="gname">\u5546\u54c1\u540d\u79f0</li><li class="yg_status">'+$shortName+'\u72b6\u6001</li><li class="joinInfo">\u53c2\u4e0e\u4eba\u6b21/'+$shortName+'\u7801</li><li class="do">\u64cd\u4f5c</li></ul>').appendTo("#goods_list");$('<div class="tips-con"><i></i>\u65e0\u76f8\u5e94\u7684'+$shortName+"\u8bb0\u5f55</div>").appendTo("#goods_list");$(".pageULEx").hide()}}})}var u=function(D,G){var H=G.parent().parent().find("input[type=text]");var F=parseInt(G.parent().parent().find("input[type=hidden]").val());var E=o(H,F);if(!E){return}var C=parseInt(H.val());if(D=="add"){if(C>=F){C=F}else{C++}}else{if(D=="sub"){if(C<=1){C=1}else{C--}}}H.val(C)};var o=function(E){var C=E.val();var D=parseInt(E.parent().parent().find("input[type=hidden]").val());if(C==""){E.val(1);alert("\u8bf7\u8f93\u5165"+$shortName+"\u4eba\u6b21\uff01");return false}else{if(isNaN(C)){E.val(1);alert("\u60a8\u8f93\u5165\u7684"+$shortName+"\u4eba\u6b21\u597d\u50cf\u4e0d\u5bf9\u54e6!");return false}else{if(parseInt(C)<1){E.val(1);alert("\u6700\u5c11\u9700"+$shortName+"1\u4eba\u6b21");return false}else{if(parseInt(C)>D){E.val(D);alert("\u672c\u671f\u6700\u591a\u53ef"+$shortName+""+D+"\u4eba\u6b21!");return false}}}}return true};var h=function(E,F){var G=E.parent().parent().find("input[type=text]");if(!o(G)){var D=E.parent().parent();$(".jian",D).focus()}else{var C=E.parent().find("input[type=hidden]").val();if(G.val()!=""&&G.val()!="0"){var json=getCookie("products");if(json==null||json==""){var val="[{'pId':"+C+",'num':"+G.val()+"}]";SetCookieByExpires("products",val,1)}else{var flag=false;json=eval("("+json+")");$.each(json,function(n,value){if(C==value.pId){value.num=(parseInt(value.num)+parseInt(G.val()));flag=true}});if(!flag){json.push({pId:+C,num:G.val()})}json=JSON.stringify(json);SetCookieByExpires("products",json,1)}location.href=$www+"/mycart/payment.html"}}};var f=function(C){if(C&&C.stopPropagation){C.stopPropagation()}else{window.event.cancelBubble=true}};var r=function(C){C=Math.round(C*1000)/1000;C=Math.round(C*100)/100;if(/^\d+$/.test(C)){return C+".00"}if(/^\d+\.\d$/.test(C)){return C+"0"}return C};$("body").click(function(C){$(this).find(".add").hide();$(this).find("a[name='appendBuy']").show();f(C)});var B=function(C,D){i=Math.floor(D/l);q.FIdx=C;q.EIdx=D;if(i>1){q.isCount=0}else{q.isCount=1}if(q.state==4){n.html(j)}else{n.html(x)}$("#divPageNav").html("");v()};function pageselectCallback2(pageNo){var url="/user/userBuyListAjaxPage.action?pageNo="+pageNo+"&userId="+userId+"&startDate="+startDate+"&endDate="+endDate;$(".pageULEx").prepend('<li class="total_page" id="pageLoading"><img src="'+$img+'/Images/loding.gif" /></li>');$.ajax({url:url,type:"post",data:"json",beforeSend:loading,success:function(data){$("#goods_list").empty();if(resultCount>0){$('<ul class="gtitle"><li>\u5546\u54c1\u56fe\u7247</li><li class="gname">\u5546\u54c1\u540d\u79f0</li><li class="yg_status">'+$shortName+'\u72b6\u6001</li><li class="joinInfo">\u53c2\u4e0e\u4eba\u6b21/'+$shortName+'\u7801</li><li class="do">\u64cd\u4f5c</li></ul>').appendTo("#goods_list");$(".pageULEx").show();$(".pageULEx").prepend('<li class="total_page">\u9875\u6b21<i>'+(pageNo+1)+"/"+Math.ceil(resultCount/5)+"</i>&nbsp;&nbsp;\u5171<i>"+resultCount+"</i>\u6761\u8bb0\u5f55</li>");for(var i=0;i<data.length;i++){if(data[i].buyStatus=="0"){var K=parseInt(data[i].productPrice)-parseInt(data[i].spellbuyCount);var H=parseFloat(data[i].spellbuyCount)/parseFloat(data[i].productPrice);var E=206*H;E=(E<1&&parseInt(data[i].spellbuyCount)>0)?1:E;$('<ul class="goods_list"><li><a href="'+$www+"/products/"+data[i].productId+'.html" class="pic" target="_blank" title=""><img src="'+$img+data[i].productImg+'"></a></li><li class="gname"><a class="blue" href="'+$www+"/products/"+data[i].productId+'.html" target="_blank">(\u7b2c'+data[i].productPeriod+"\u671f)"+data[i].productName+'</a><p class="gray02">\u4ef7\u503c\uff1a<span class="money"><i class="rmb"></i>'+data[i].productPrice+'.00</span></p><div class="Progress-bar"><p><span style="width: '+E+'px"></span></p><ul class="Pro-bar-li"><li class="P-bar01"><em>'+data[i].spellbuyCount+'</em>\u5df2\u53c2\u4e0e\u4eba\u6b21</li><li class="P-bar02"><em>'+data[i].productPrice+'</em>\u603b\u9700\u4eba\u6b21</li><li class="P-bar03"><em>'+K+'</em>\u5269\u4f59\u4eba\u6b21</li></ul></div></li><li class="yg_status"><span class="green">\u6b63\u5728\u8fdb\u884c\u2026\u2026</span><br><a class="gray01" name="appendBuy" href="JavaScript:;">\u8ffd\u52a0'+$shortName+'\u4eba\u6b21</a><div style="display:none;" class="add"><dl><input type="hidden" value="'+K+'"><dd><input type="text" value="" class="amount" onpaste="return false" title="\u8d2d\u4e70\u4eba\u6b21"></dd><dd><a href="JavaScript:;" class="jia"></a><a href="JavaScript:;" class="jian"></a></dd><dd><input type="hidden" value="'+data[i].productId+'"><input type="button" name="btnAppendBuy" value="\u786e \u5b9a" class="orangebut btn29" title="\u8ffd\u52a0'+$shortName+'\u4eba\u6b21"></dd></dl></div></li><li buynum="'+data[i].buyCount+'" codeid="'+data[i].productId+'" class="joinInfo"><p><em>'+data[i].buyCount+'</em>\u4eba\u6b21</p><div class="joinInfo-Pop"><div class="grhead-join gray01" name="divTip" style="display: block;">\u6240\u6709'+$shortName+'\u7801<b></b></div><div style="display: none;" class="grhead-joinC" name="divShowRNO"><div class="grhead-joinCT gray01">\u6240\u6709'+$shortName+'\u7801<b></b></div><div class="grhead-joinClist" name="divRNOList"></div></div></div></li><li class="do"><a title="\u8be6\u60c5" class="blue" href="'+$www+"/user/UserBuyDetail-"+data[i].productId+'.html">\u8be6\u60c5</a></li></ul>').appendTo("#goods_list")}else{$('<ul class="goods_list"><li><a href="'+$www+"/products/"+data[i].productId+'.html" class="pic" target="_blank" title=""><img src="'+$img+data[i].productImg+'"></a></li><li class="gname"><a class="blue" href="'+$www+"/products/"+data[i].productId+'.html" target="_blank">(\u7b2c'+data[i].productPeriod+"\u671f)"+data[i].productName+'</a><p class="gray02">\u83b7\u5f97\u8005\uff1a<a class="blue" target="_blank" href="'+$www+"/u/"+data[i].winUserId+'.html">'+data[i].winUser+'</a></p><p class="gray02">\u63ed\u6653\u65f6\u95f4\uff1a'+data[i].winDate+'</p></li><li class="yg_status"><span class="orange">\u5df2\u63ed\u6653</span></li><li buynum="'+data[i].buyCount+'" codeid="'+data[i].productId+'" class="joinInfo"><p><em>'+data[i].buyCount+'</em>\u4eba\u6b21</p><div class="joinInfo-Pop"><div class="grhead-join gray01" name="divTip">\u6240\u6709'+$shortName+'\u7801<b></b></div><div style="display:none;" class="grhead-joinC" name="divShowRNO"><div class="grhead-joinCT gray01">\u6240\u6709'+$shortName+'\u7801<b></b></div><div class="grhead-joinClist" name="divRNOList"></div></div></div></li><li class="do"><a title="\u8be6\u60c5" class="blue" href="'+$www+"/user/UserBuyDetail-"+data[i].productId+'.html">\u8be6\u60c5</a></li></ul>').appendTo("#goods_list")}}$("#pageLoading").hide();$("a[name='appendBuy']",M).click(function(N){$(this).parent().parent().siblings().each(function(){$(this).find(".add").hide();$(this).find("a[name='appendBuy']").show()});$(this).parent().find(".add").show().click(function(O){f(O)});$(this).parent().find("input[type=text]").focus().val("1").select();$(this).hide();f(N)});$(".amount",M).mouseover(function(){$(this).focus().select()}).keydown(function(O){if(13==((window.event)?event.keyCode:O.keyCode)){var N=$(this).parent().parent().find("input[type=button]");h(N,O)}f(O)});$(".jia",M).click(function(){var N=$(this).parent().parent().find("input[type=text]");if(isNaN(parseInt(N.val()))){return}u("add",$(this))});$(".jian",M).click(function(){var O=$(this).parent().parent().find("input[type=text]");var N=O.val();if(isNaN(parseInt(N))||N=="0"){O.focus().select();return}u("sub",$(this))});$("input[name='btnAppendBuy']",M).click(function(N){h($(this),N)});$(".joinInfo",M).hover(function(){var Q=$(this);Q.find("div[name='divTip']").hide();Q.find("div[name='divShowRNO']").show();var N=Q.attr("codeID");var O=Q.attr("buyNum");var P=Q.find("div[name='divRNOList']");e(P,N,O)},function(){$(this).find("div[name='divTip']").show();$(this).find("div[name='divShowRNO']").hide();p.remove()})}else{$('<div class="tips-con"><i></i>\u65e0\u76f8\u5e94\u7684'+$shortName+"\u8bb0\u5f55</div>").appendTo("#goods_list");$(".pageULEx").hide()}}})}function loading(){$("#pageLoading").show()}var e=function(E,D,C){if(!isLoaded){return}p.html("\u6b63\u5728\u52a0\u8f7d...");E.append(p);$.ajax({url:"/user/getRandomNumberList.action?id="+D+"&userId="+userId,data:"JSON",type:"GET",success:function(data){var H="";var I=data.length;H=data.substring(0,85);if(I>85){H+='<li><a href="/user/UserBuyDetail-'+D+'.html" >\u67e5\u770b\u66f4\u591a</a></li>'}p.html(H).show()},error:function(){location.reload()}})};var selectTime=function(W){var selectVal=W;$.ajax({url:"/user/getuserBuyListAjaxPageResultCount.action?pageNo="+pageNo+"&selectTime="+selectVal+"&userId="+userId,type:"get",data:"String",success:function(data){resultCount=parseInt(data);$("#pagination").pagination(resultCount,{current_page:pageNo,prev_text:"\u4e0a\u4e00\u9875",next_text:"\u4e0b\u4e00\u9875",num_display_entries:5,num_edge_entries:1,link_to:"",prev_show_always:false,next_show_always:false,items_per_page:5,callback:pageselectCallback})}})};N.click(function(){$(".record-tab a").attr("class","");$("#goods_list").empty();c()});var c=function(){var d=X.val();var e=F.val();if(!IsValidDate(d)){alert("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u5f00\u59cb\u65e5\u671f!");return}if(!IsValidDate(e)){alert("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u7ed3\u675f\u65e5\u671f!");return}if(ConvertDate(e)<ConvertDate(d)){alert("\u7ed3\u675f\u65e5\u671f\u4e0d\u80fd\u5c0f\u4e8e\u5f00\u59cb\u65e5\u671f!");return}$.ajax({url:"/user/getuserBuyListAjaxPageResultCount.action?pageNo="+pageNo+"&userId="+userId+"&startDate="+d+"&endDate="+e,type:"get",data:"String",success:function(data){resultCount=parseInt(data);startDate=d;endDate=e;$("#pagination").pagination(resultCount,{current_page:pageNo,prev_text:"\u4e0a\u4e00\u9875",next_text:"\u4e0b\u4e00\u9875",num_display_entries:5,num_edge_entries:1,link_to:"",prev_show_always:false,next_show_always:false,items_per_page:5,callback:pageselectCallback2})}})};function SetCookieByExpires(name,value,date){var Days=date;var exp=new Date();exp.setTime(exp.getTime()+Days*24*60*60*1000);document.cookie=name+"="+escape(value)+";id=1ypg;path=/;expires="+exp.toGMTString()+";domain="+$domain}function getCookie(name){var arr=document.cookie.match(new RegExp("(^| )"+name+"=([^;]*)(;|$)"));if(arr!=null){return unescape(arr[2])}return null}isLoaded=true;X.val(a.DateAdd("m",-1).Format("YYYY-MM-DD")).date_input();F.val(a.Format("YYYY-MM-DD")).date_input()});
